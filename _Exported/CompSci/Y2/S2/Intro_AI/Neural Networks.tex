\documentclass[12pt letter]{report}
\input{./template/preamble}
\input{./template/macros}
\input{./template/letterfonts}

\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{4}
\usepackage{parskip}


    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Keep aspect ratio if custom image width or height is specified
    \setkeys{Gin}{keepaspectratio}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}


    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{\Huge{Neural Networks}}
    
\date{}

    
\author{\huge{Madiba Hudson-Quansah}}

    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@ges}{\let\PY@bf=\textbf\let\PY@it=\textit}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
\newpage
\pdfbookmark[section]{\contentsname}{too}
    
    \maketitle
    
    
    \tableofcontents
\newpage


    
\chapter{Artificial Neural Networks}\label{artificial-neural-networks}

An Artificial Neural Network (ANN) is a computational model that is
inspired by the way biological neural networks in the human brain work.
It is composed of a large number of highly interconnected processing
elements (neurons) working in unison to solve specific problems. ANNs,
like people, learn by example and are thus capable of solving
unsupervised as well as supervised learning tasks.

\section{Biological Neurons}\label{biological-neurons}

Artificial Neural Networks being inspired by biological neural networks
are composed of neurons, thus to understand the decision designs of ANNs
we must first understand the biological neuron. Neurons are made up of
three parts, the \emph{soma} or the cell body, the \emph{axon} and
\emph{dendrites} A neuron is a specialized cell responsible for the
creation and transportation of short electrical impulses called
\emph{action potentials} / AP / signals, used to communicate with other
neurons with the overarching goal of transmitting information throughout
the body. Through this vast network of neurons, the brain is able to
perform highly complex computations. Research shows that neurons in the
brain are organized in consecutive layers with each layer performing a
specific task. This is the basis of the design of ANNs.

\section{Logical Computation with
Neurons}\label{logical-computation-with-neurons}

The Artificial Neuron is designed on this framework of the biological
neuron, with a simple ANN proposed by McCulloch and Pitts, having one or
more binary inputs and one binary output. The artificial neuron
activates its output when more than a certain number of its inputs are
active, allowing for simple computation of logical functions, such as
propositional logic. For example a simple neuron designed to perform the
logical AND operation:

Let the output neuron be \(C\) and take two input neuron \(A\) and
\(B\). As the neuron \(C\) always requires two input signals to give an
output signal we can then require the two input signals to only give one
output signal if activated. This would in turn require both neurons
\(A\) and \(B\) to be activated to give an output signal for neuron
\(C\), thus performing the logical AND operation.

\section{The Perceptron}\label{the-perceptron}

A simple ANN, based on a artificial neuron called a \emph{threshold
logic unit} (TLU) / \emph{linear threshold unit} (LTU). It inputs and
outputs numbers and each input connection is associated with a weight.
The TLU first computes a linear function of its inputs \[
z = w_1 x_1 + \ldots + w_n x_n + b = \mathbf{w}^T \mathbf{x} + b
\] Where the model parameters are the input weights \(\mathbf{w}\) and
\(b\) is the bias term

It then applies a \textbf{step function} to the result \[
h_w(\mathbf{x}) = \text{step}(z)
\] A common step function used in perceptrons is the \emph{Heavyside
step function}, and the \emph{sign function} defined: \[
\text{heavyside}(z) = \begin{cases}
0 & \text{ if } z < 0 \\
1 & \text{ if } z \ge 0
\end{cases}
\]

\[
\text{sgn}(z) = \begin{cases}
-1 & \text{ if } z < 0 \\
0 & \text{ if } z = 0 \\
+1 & \text{ if } z > 0
\end{cases}
\]

A perceptron is composed of one or more TLUs organized in a single
layer, where every TLU is connected to every input. Such a layer is
called a fully \textbf{connected layer} or a \textbf{dense layer}, and
the inputs constitute the \textbf{input layer}. As the final layer of
TLU's produce the output this layer is called the \textbf{output layer}.

Using linear algebra the outputs of nodes in the output layers, for
several instances at once, i.e.: \[
h_{W, b} (X) = \phi (XW + b)
\]

Where:

\begin{itemize}
\item
  \(W\) is a matrix containing all the connection weights, with one row
  per unit and one column per node.
\item
  \(X\) is a matrix containing the input features, with noe row per
  instance and one colum per feature, where and instance is a data
  point.
\item
  \(b\) is the bias vector that contains all the bias terms, one entry
  per neuron, where whe entires in \(b\) are broadcasted across the rows
  of \(XW\).
\item
  \(\phi\) is the \textbf{activation function}, but when the artificial
  neurons are TLUs this is termed as the step function
\end{itemize}

The perceptron training algorithm is largely inspired by Hebb's rule,
which suggests what when neurons on either side of a synapse or in the
case of artificial neurons connection, fire together the connection
between them is strengthened. This results in the strengthening of
connections that help reduce the error in the output layer.

The perceptron is fed one training instance at a time and for each
instance it makes predictions. For every output neuron that produced a
wrong prediction, it reinforces the connection weights from the inputs
that would have contributed to the correct prediction. The rule is as
follows:

\[
w_{i, j}^{\text{next step}} = w_{i,j} + \eta (y_j - \hat{y_j})x_i
\]

Where:

\begin{itemize}
\item
  \(w_{i,j}\) is the connection weight between the \(i\) th input neuron
  and the \(j\) th neuron.
\item
  \(x_i\) is the \(i\) th input value of the current training instance.
\item
  \(\hat{y_j}\) is the output of the \(j\) th output neuron for the
  current training instance.
\item
  \(y_j\) is the target output of the \(j\) th output neuron for the
  current training instance.
\item
  \(\eta\) is the learning rate.
\end{itemize}

The decision boundary of each output neuron is linear, so perceptrons
are incapable of learning complex patterns (just like logistic
regression classifiers). However, if the training instances are linearly
separable, Rosenblatt demonstrated that this algorithm would converge to
a solution.⁠ This is called the \textbf{perceptron convergence theorem}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{1}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{sys}

\PY{o}{!}\PY{o}{\PYZob{}}sys.executable\PY{o}{\PYZcb{}}\PY{+w}{ }\PYZhy{}m\PY{+w}{ }pip\PY{+w}{ }install\PY{+w}{ }pydot
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Requirement already satisfied: pydot in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (2.0.0)
Requirement already satisfied: pyparsing>=3 in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from pydot) (3.1.2)

\textbf{[}\textcolor{ansi-blue}{notice}\textbf{]} A new release of pip is
available: \textcolor{ansi-red}{24.2} -> \textcolor{ansi-green}{24.3.1}
\textbf{[}\textcolor{ansi-blue}{notice}\textbf{]} To update, run:
\textcolor{ansi-green}{pip install --upgrade pip}
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{numpy}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{np}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{datasets}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{load\PYZus{}iris}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{Perceptron}

\PY{n}{iris} \PY{o}{=} \PY{n}{load\PYZus{}iris}\PY{p}{(}\PY{n}{as\PYZus{}frame}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{X} \PY{o}{=} \PY{n}{iris}\PY{o}{.}\PY{n}{data}\PY{p}{[}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{petal length (cm)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{petal width (cm)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{values}
\PY{n}{y} \PY{o}{=} \PY{n}{iris}\PY{o}{.}\PY{n}{target} \PY{o}{==} \PY{l+m+mi}{0}

\PY{n}{per} \PY{o}{=} \PY{n}{Perceptron}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}
\PY{n}{per}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)}

\PY{n}{XNew} \PY{o}{=} \PY{p}{[}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mf}{0.5}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}
\PY{n}{per}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{XNew}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
array([ True, False])
\end{Verbatim}
\end{tcolorbox}
        
\section{Multilayer Perceptron (MLP) and
Backpropagation}\label{multilayer-perceptron-mlp-and-backpropagation}

An MLP is composed of one input layer, one or more layers of TLUs called
\emph{hidden layers} and one output layer, also comprised of TLUs.
Layers close the input layers are called the \emph{lower layers} and
those close to the output layers are called \emph{upper layers}.

When signals only flow from the input layer across, hidden layers and
finally stopping at the output layers, i.e one direction, the resulting
architecture is called a \textbf{Feedforward Neural Network (FNN)}.

When an ANN contains a deep stack of hidden layers, it is called a
\textbf{Deep Neural Network (DNN)}. A deep stack is when the number of
hidden layers is large, typically more than 10.

Using the \emph{reverse-mode automatic differentiation / reverse-mode
autodiff} algorithm the gradient of a ANN's error in relation to the
parameters it's given can be computed. Using this gradient it is
possible to perform gradient descent to find the optimal weights and
biases for the ANN, i.e.~the parameters that minimize the error. This
combination of both the reverse-mode autodiff and gradient descent is
called \textbf{Backpropagation}.

Going into detail the Backpropagation algorithm is as follows:

\begin{itemize}
\item
  A mini-batch (for example 32 instances) of the training data is used
  at a time, and the algorithm goes through the full training data
  several times. Each time through the full training data is called an
  \textbf{epoch}.
\item
  Each mini-batch enters the network through the input layer, then the
  output of the all the neurons in the first hidden layer is computed
  for each instance in the mini-batch. The result is then passed to the
  subsequent hidden layer and computed so on until the output layer is
  reached. This is called a \textbf{forward pass}, where the model makes
  predictions but all the intermediate results between hidden layers are
  stored for use in the backwards pass.
\item
  The algorithm then calculates the model's output error, using a loss
  function that compares the result to the desired output of the network
  for the given parameters and returns the measure of the error.
\item
  Then it computes how much each output bias and each connection to the
  output layer contributed to the error, by analytically applying the
  chain rule.
\item
  The algorithm then measures how much of these error contributions came
  from each connection in the layer below, again using the chain rule,
  working backwards until it reaches the input layer. This is called the
  \textbf{backward / reverse pass}.
\item
  Finally the algorithm performs a gradient descent step to tweak all
  the connections in the network, using the error contributions computed
  earlier. This is called the \textbf{gradient descent step}.
\end{itemize}

In order for Backpropagation to work properly it needs a gradient to
work with, thus the step functions normally used in single layer
perceptrons are replaced with differentiable functions, such as the
\textbf{logistic / sigmoid function}, \textbf{hyperbolic tangent
function} and the \textbf{rectified linear unit function (ReLU)},
defined below:

\[
\text{sigmoid}(z) = \frac{1}{1 + \exp(-z)}
\]

\[
\tanh(z) = 2 \sigma(2z) - 1
\]

\[
\text{ReLU}(z) = \max(0, z)
\]

\section{Regression MLPs}\label{regression-mlps}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.5333}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.4667}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Hyperparameter
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Typical Value
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\# hidden layers & Depends on the problem typically 1 - 5 \\
\# neurons per hidden layer & Depends on the problem typically 10 -
100 \\
\# output neurons & 1 per prediction dimension \\
hidden activation & ReLu \\
output activation & None, or ReLU/ softplus if positive outputs or
sigmoid / tanhn if bounded \\
Loss function & MSE, or huber if outliers \\
\end{longtable}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{datasets}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{fetch\PYZus{}california\PYZus{}housing}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{neural\PYZus{}network}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{MLPRegressor}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{pipeline}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{Pipeline}\PY{p}{,} \PY{n}{make\PYZus{}pipeline}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{preprocessing}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{StandardScaler}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{root\PYZus{}mean\PYZus{}squared\PYZus{}error}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{train\PYZus{}test\PYZus{}split}

\PY{n}{housing} \PY{o}{=} \PY{n}{fetch\PYZus{}california\PYZus{}housing}\PY{p}{(}\PY{p}{)}
\PY{n}{XTrainFull}\PY{p}{,} \PY{n}{XTest}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{,} \PY{n}{yTest} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
    \PY{n}{housing}\PY{o}{.}\PY{n}{data}\PY{p}{,} \PY{n}{housing}\PY{o}{.}\PY{n}{target}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}
\PY{p}{)}
\PY{n}{XTrain}\PY{p}{,} \PY{n}{XValid}\PY{p}{,} \PY{n}{yTrain}\PY{p}{,} \PY{n}{yValid} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
    \PY{n}{XTrainFull}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}
\PY{p}{)}

\PY{n}{mlpReg} \PY{o}{=} \PY{n}{MLPRegressor}\PY{p}{(}
    \PY{n}{hidden\PYZus{}layer\PYZus{}sizes}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}
\PY{p}{)}
\PY{n}{mlpRegPipe} \PY{o}{=} \PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{mlpReg}\PY{p}{)}
\PY{n}{mlpRegPipe}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
/home/mads/.pyenv/versions/ai/lib/python3.12/site-
packages/sklearn/neural\_network/\_multilayer\_perceptron.py:697: UserWarning:
Training interrupted by user.
  warnings.warn("Training interrupted by user.")
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
Pipeline(steps=[('standardscaler', StandardScaler()),
                ('mlpregressor',
                 MLPRegressor(hidden\_layer\_sizes=[50, 50, 50],
                              random\_state=42))])
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{preds} \PY{o}{=} \PY{n}{mlpRegPipe}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{XValid}\PY{p}{)}
\PY{n}{rmse} \PY{o}{=} \PY{n}{root\PYZus{}mean\PYZus{}squared\PYZus{}error}\PY{p}{(}\PY{n}{yValid}\PY{p}{,} \PY{n}{preds}\PY{p}{)}
\PY{n}{rmse}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
0.5053326657968522
\end{Verbatim}
\end{tcolorbox}
        
\section{Classification MLPs}\label{classification-mlps}

For binary classification the output neuron has to have a bounded
activation function like sigmoid so the output will be a number between
0 and 1, which can be interpreted as the estimated probability of the
positive class. The estimated probability of the negative class is equal
to one minus that number.

For multilabel binary classification the output layer should have one
output neuron per class, and each neuron should have a sigmoid
activation function, where the first neuron predicts the probability of
the first class, the second neuron the probability of the second class
and so on.

If each instance can only belong to one category out of all the possible
categories, then the output layer should have one neuron per class and
use the \textbf{softmax} activation function for the whole output layer.
This ensures that the sum of all the estimated class probabilities for
each instance is equal to one, and that the estimated class
probabilities are all non-negative.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.1633}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2449}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.3367}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2551}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Hyperparameter
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Binary Classification
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Multilabel Binary Classification
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Multiclass Classification
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\# hidden layers & Typically 1 - 5 layers, depending on the task &
Typically 1 - 5 layers, depending on the task & Typically 1 - 5 layers,
depending on the task \\
\# output neurons & 1 & 1 per binary label & 1 per class \\
Output activation & Sigmoid & Sigmoid & Softmax \\
Loss function & Cross-entropy & Cross-entropy & Cross-entropy \\
\end{longtable}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{datasets}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{load\PYZus{}iris}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{neural\PYZus{}network}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{MLPClassifier}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{classification\PYZus{}report}\PY{p}{,} \PY{n}{ConfusionMatrixDisplay}

\PY{n}{iris} \PY{o}{=} \PY{n}{load\PYZus{}iris}\PY{p}{(}\PY{p}{)}
\PY{n}{XTrainFull}\PY{p}{,} \PY{n}{XTest}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{,} \PY{n}{yTest} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
    \PY{n}{iris}\PY{o}{.}\PY{n}{data}\PY{p}{,} \PY{n}{iris}\PY{o}{.}\PY{n}{target}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}
\PY{p}{)}
\PY{n}{XTrain}\PY{p}{,} \PY{n}{XValid}\PY{p}{,} \PY{n}{yTrain}\PY{p}{,} \PY{n}{yValid} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
    \PY{n}{XTrainFull}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}
\PY{p}{)}

\PY{n}{mlpCls} \PY{o}{=} \PY{n}{MLPClassifier}\PY{p}{(}\PY{n}{hidden\PYZus{}layer\PYZus{}sizes}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{]}\PY{p}{,} \PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{10000}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}
\PY{n}{mlpClsPipe} \PY{o}{=} \PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{mlpCls}\PY{p}{)}
\PY{n}{mlpClsPipe}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
Pipeline(steps=[('standardscaler', StandardScaler()),
                ('mlpclassifier',
                 MLPClassifier(hidden\_layer\_sizes=[10], max\_iter=10000,
                               random\_state=42))])
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{preds} \PY{o}{=} \PY{n}{mlpClsPipe}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{XTest}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{yTest}\PY{p}{,} \PY{n}{preds}\PY{p}{)}\PY{p}{)}
\PY{n}{ConfusionMatrixDisplay}\PY{o}{.}\PY{n}{from\PYZus{}predictions}\PY{p}{(}\PY{n}{yTest}\PY{p}{,} \PY{n}{preds}\PY{p}{,} \PY{n}{display\PYZus{}labels}\PY{o}{=}\PY{n}{iris}\PY{o}{.}\PY{n}{target\PYZus{}names}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
              precision    recall  f1-score   support

           0       1.00      1.00      1.00        15
           1       1.00      1.00      1.00        11
           2       1.00      1.00      1.00        12

    accuracy                           1.00        38
   macro avg       1.00      1.00      1.00        38
weighted avg       1.00      1.00      1.00        38

    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<sklearn.metrics.\_plot.confusion\_matrix.ConfusionMatrixDisplay at
0x72e040109430>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Neural Networks_files/Neural Networks_9_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
\section{Implementing MLPs in Keras}\label{implementing-mlps-in-keras}

\subsection{Building an Image Classifier using the Sequential
API}\label{building-an-image-classifier-using-the-sequential-api}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{tensorflow}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{tf}

\PY{n}{fmnist} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{datasets}\PY{o}{.}\PY{n}{fashion\PYZus{}mnist}\PY{o}{.}\PY{n}{load\PYZus{}data}\PY{p}{(}\PY{p}{)}
\PY{p}{(}\PY{n}{XTrainFull}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{n}{XTest}\PY{p}{,} \PY{n}{yTest}\PY{p}{)} \PY{o}{=} \PY{n}{fmnist}

\PY{n}{cutoff} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{5000}
\PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain} \PY{o}{=} \PY{n}{XTrainFull}\PY{p}{[}\PY{p}{:}\PY{n}{cutoff}\PY{p}{]}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{[}\PY{p}{:}\PY{n}{cutoff}\PY{p}{]}
\PY{n}{XValid}\PY{p}{,} \PY{n}{yValid} \PY{o}{=} \PY{n}{XTrainFull}\PY{p}{[}\PY{n}{cutoff}\PY{p}{:}\PY{p}{]}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{[}\PY{n}{cutoff}\PY{p}{:}\PY{p}{]}
\PY{n}{XTrain}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
2024-07-23 12:14:52.971955: I tensorflow/core/util/port.cc:113] oneDNN custom
operations are on. You may see slightly different numerical results due to
floating-point round-off errors from different computation orders. To turn them
off, set the environment variable `TF\_ENABLE\_ONEDNN\_OPTS=0`.
2024-07-23 12:14:52.980310: I external/local\_tsl/tsl/cuda/cudart\_stub.cc:32]
Could not find cuda drivers on your machine, GPU will not be used.
2024-07-23 12:14:53.063492: I external/local\_tsl/tsl/cuda/cudart\_stub.cc:32]
Could not find cuda drivers on your machine, GPU will not be used.
2024-07-23 12:14:53.161670: E
external/local\_xla/xla/stream\_executor/cuda/cuda\_fft.cc:479] Unable to register
cuFFT factory: Attempting to register factory for plugin cuFFT when one has
already been registered
2024-07-23 12:14:53.250069: E
external/local\_xla/xla/stream\_executor/cuda/cuda\_dnn.cc:10575] Unable to
register cuDNN factory: Attempting to register factory for plugin cuDNN when one
has already been registered
2024-07-23 12:14:53.250963: E
external/local\_xla/xla/stream\_executor/cuda/cuda\_blas.cc:1442] Unable to
register cuBLAS factory: Attempting to register factory for plugin cuBLAS when
one has already been registered
2024-07-23 12:14:53.390184: I tensorflow/core/platform/cpu\_feature\_guard.cc:210]
This TensorFlow binary is optimized to use available CPU instructions in
performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512\_VNNI FMA, in other
operations, rebuild TensorFlow with the appropriate compiler flags.
2024-07-23 12:14:54.502765: W
tensorflow/compiler/tf2tensorrt/utils/py\_utils.cc:38] TF-TRT Warning: Could not
find TensorRT
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(55000, 28, 28)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{XTrain}\PY{p}{,} \PY{n}{XValid}\PY{p}{,} \PY{n}{XTest} \PY{o}{=} \PY{n}{XTrain} \PY{o}{/} \PY{l+m+mf}{255.0}\PY{p}{,} \PY{n}{XValid} \PY{o}{/} \PY{l+m+mf}{255.0}\PY{p}{,} \PY{n}{XTest} \PY{o}{/} \PY{l+m+mf}{255.0}
\PY{n}{classNames} \PY{o}{=} \PY{p}{[}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{T\PYZhy{}shirt/top}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Trouser}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Pullover}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Dress}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Coat}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sandal}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Shirt}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sneaker}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bag}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ankle boot}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{p}{]}


\PY{k}{def}\PY{+w}{ }\PY{n+nf}{name}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{n}{classNames}\PY{p}{[}\PY{n}{x}\PY{p}{]}


\PY{n}{name}\PY{p}{(}\PY{n}{yTrain}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
'Ankle boot'
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Set random seed for reproducible results}
\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{utils}\PY{o}{.}\PY{n}{set\PYZus{}random\PYZus{}seed}\PY{p}{(}\PY{l+m+mi}{42}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create a Sequential model a single stack of layers connected sequentially}
\PY{n+nb+bp}{cls} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Sequential}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} The first layer, an Input layer, added to the model with shape}
\PY{c+c1}{\PYZsh{} 28x28, needed to determine the shape of the weight matrix of te}
\PY{c+c1}{\PYZsh{} first hidden layer}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{28}\PY{p}{]}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} A Flatten layer to convert the input images into 1D arrays}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Flatten}\PY{p}{(}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} A Dense layer with 300 neurons, using the ReLU activation function}
\PY{c+c1}{\PYZsh{} Each Dense layer manages it\PYZsq{}s own weight matrix containing the connection weights}
\PY{c+c1}{\PYZsh{} between neurons and their inputs}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{300}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} A second Dense layer with 100 neurons, also using the ReLU activation function}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} A final Dense layer as the output layer with 10 neurons, one per category}
\PY{c+c1}{\PYZsh{} And using the softmax activation function as classes are exclusive}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{softmax}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{Model: "sequential"}

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃\textbf{ }\textbf{Layer (type)                   }\textbf{ }┃\textbf{ }\textbf{Output Shape          }\textbf{ }┃\textbf{ }\textbf{      Param \#}\textbf{ }┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ flatten (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Flatten})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{784})            │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                   │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{300})            │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{235,500} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_1 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                 │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{100})            │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{30,100} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_2 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                 │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{10})             │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,010} │
└─────────────────────────────────┴────────────────────────┴───────────────┘

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Total params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{266,610} (1.02 MB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{266,610} (1.02 MB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Non-trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} (0.00 B)

    \end{Verbatim}

    
These steps can be condensed as seen below with the first \texttt{Input}
layer dropped and the \texttt{input\_shape} specified in the first layer

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb+bp}{cls} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Sequential}\PY{p}{(}
    \PY{p}{[}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{28}\PY{p}{]}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Flatten}\PY{p}{(}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{300}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{leaky\PYZus{}relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{leaky\PYZus{}relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{softmax}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{p}{]}
\PY{p}{)}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{Model: "sequential\_1"}

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃\textbf{ }\textbf{Layer (type)                   }\textbf{ }┃\textbf{ }\textbf{Output Shape          }\textbf{ }┃\textbf{ }\textbf{      Param \#}\textbf{ }┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ flatten\_1 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Flatten})             │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{784})            │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_3 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                 │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{300})            │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{235,500} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_4 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                 │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{100})            │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{30,100} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_5 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                 │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{10})             │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,010} │
└─────────────────────────────────┴────────────────────────┴───────────────┘

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Total params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{266,610} (1.02 MB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{266,610} (1.02 MB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Non-trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} (0.00 B)

    \end{Verbatim}

    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{display}\PY{p}{(}\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{layers}\PY{p}{)}
\PY{n}{hid1} \PY{o}{=} \PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{layers}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\PY{n}{w}\PY{p}{,} \PY{n}{b} \PY{o}{=} \PY{n}{hid1}\PY{o}{.}\PY{n}{get\PYZus{}weights}\PY{p}{(}\PY{p}{)}
\PY{n}{b}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
[<Flatten name=flatten\_1, built=True>,
 <Dense name=dense\_3, built=True>,
 <Dense name=dense\_4, built=True>,
 <Dense name=dense\_5, built=True>]
    \end{Verbatim}

    
            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], dtype=float32)
\end{Verbatim}
\end{tcolorbox}
        
\subsubsection{Compiling the Model}\label{compiling-the-model}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Loss \PYZhy{} Specifies the loss function to use when minimizing the value of the loss function}
\PY{c+c1}{\PYZsh{} Optimize \PYZhy{} Specifies the optimization algorithm to use in reducing the loss function}
\PY{c+c1}{\PYZsh{} Metrics \PYZhy{} Specifies other metrics to monitor during training and testing}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{compile}\PY{p}{(}
    \PY{n}{loss}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sparse\PYZus{}categorical\PYZus{}crossentropy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{optimizer}\PY{o}{=}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{SGD}\PY{p}{(}\PY{p}{)}\PY{p}{,}
    \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

\begin{itemize}
\item
  We use \texttt{sparse\_categorical\_crossentropy} loss as we have
  sparse labels, for each instance there is just a target class index
  from 0 to 9, and the classes are exclusive. If we instead had one
  target probabilty per class for each instance for example when using
  One Hot Encoding, we would use \texttt{categorical\_crossentropy}
  loss. When doing binary classification or multilabel binary
  classification we would use the \texttt{binary\_crossentropy} loss
\item
  The optimizer \texttt{sgd} stands for \emph{Stochastic Gradient
  Descent}, and means the model will be trained using this gradient
  descent variant. The \texttt{sgd} optimizer will perform the
  backpropagation algorithm. When using the \texttt{sdg} optimizer it is
  important to set a learning rate, this can be done by passing
  \texttt{tf.keras.optimizers.SGD(learning\_rate=x)} where \texttt{x} is
  the learning rate
\end{itemize}

\subsubsection{Training and Evaluating the
Model}\label{training-and-evaluating-the-model}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{hist} \PY{o}{=} \PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain}\PY{p}{,} \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{30}\PY{p}{,} \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{n}{XValid}\PY{p}{,} \PY{n}{yValid}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.6862 - loss: 0.9684 - val\_accuracy: 0.8304 - val\_loss: 0.5021
Epoch 2/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8262 - loss: 0.5073 - val\_accuracy: 0.8400 - val\_loss: 0.4540
Epoch 3/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 1ms/step -
accuracy: 0.8420 - loss: 0.4570 - val\_accuracy: 0.8466 - val\_loss: 0.4333
Epoch 4/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8505 - loss: 0.4295 - val\_accuracy: 0.8470 - val\_loss: 0.4207
Epoch 5/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8570 - loss: 0.4097 - val\_accuracy: 0.8506 - val\_loss: 0.4106
Epoch 6/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8618 - loss: 0.3941 - val\_accuracy: 0.8528 - val\_loss: 0.4020
Epoch 7/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8670 - loss: 0.3810 - val\_accuracy: 0.8552 - val\_loss: 0.3963
Epoch 8/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8704 - loss: 0.3696 - val\_accuracy: 0.8564 - val\_loss: 0.3912
Epoch 9/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8732 - loss: 0.3596 - val\_accuracy: 0.8582 - val\_loss: 0.3856
Epoch 10/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8758 - loss: 0.3507 - val\_accuracy: 0.8602 - val\_loss: 0.3817
Epoch 11/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8784 - loss: 0.3426 - val\_accuracy: 0.8634 - val\_loss: 0.3768
Epoch 12/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8806 - loss: 0.3350 - val\_accuracy: 0.8644 - val\_loss: 0.3739
Epoch 13/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8829 - loss: 0.3280 - val\_accuracy: 0.8654 - val\_loss: 0.3708
Epoch 14/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8845 - loss: 0.3213 - val\_accuracy: 0.8658 - val\_loss: 0.3687
Epoch 15/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8863 - loss: 0.3152 - val\_accuracy: 0.8668 - val\_loss: 0.3667
Epoch 16/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 1ms/step -
accuracy: 0.8884 - loss: 0.3093 - val\_accuracy: 0.8666 - val\_loss: 0.3629
Epoch 17/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8900 - loss: 0.3037 - val\_accuracy: 0.8674 - val\_loss: 0.3609
Epoch 18/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8918 - loss: 0.2984 - val\_accuracy: 0.8678 - val\_loss: 0.3598
Epoch 19/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8938 - loss: 0.2934 - val\_accuracy: 0.8686 - val\_loss: 0.3590
Epoch 20/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8958 - loss: 0.2885 - val\_accuracy: 0.8686 - val\_loss: 0.3580
Epoch 21/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.8979 - loss: 0.2838 - val\_accuracy: 0.8700 - val\_loss: 0.3593
Epoch 22/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9001 - loss: 0.2792 - val\_accuracy: 0.8694 - val\_loss: 0.3567
Epoch 23/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9014 - loss: 0.2748 - val\_accuracy: 0.8704 - val\_loss: 0.3590
Epoch 24/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 1ms/step -
accuracy: 0.9030 - loss: 0.2707 - val\_accuracy: 0.8722 - val\_loss: 0.3579
Epoch 25/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9044 - loss: 0.2666 - val\_accuracy: 0.8722 - val\_loss: 0.3559
Epoch 26/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9056 - loss: 0.2627 - val\_accuracy: 0.8712 - val\_loss: 0.3577
Epoch 27/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9070 - loss: 0.2589 - val\_accuracy: 0.8710 - val\_loss: 0.3560
Epoch 28/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9086 - loss: 0.2552 - val\_accuracy: 0.8714 - val\_loss: 0.3571
Epoch 29/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9099 - loss: 0.2516 - val\_accuracy: 0.8722 - val\_loss: 0.3569
Epoch 30/30
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9115 - loss: 0.2480 - val\_accuracy: 0.8730 - val\_loss: 0.3553
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{plt}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{classification\PYZus{}report}\PY{p}{,} \PY{n}{ConfusionMatrixDisplay}


\PY{k}{def}\PY{+w}{ }\PY{n+nf}{classStats}\PY{p}{(}\PY{n}{actuals}\PY{p}{,} \PY{n}{preds}\PY{p}{,} \PY{n}{classNames}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{actuals}\PY{p}{,} \PY{n}{preds}\PY{p}{)}\PY{p}{)}
    \PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
    \PY{n}{ConfusionMatrixDisplay}\PY{o}{.}\PY{n}{from\PYZus{}predictions}\PY{p}{(}
        \PY{n}{actuals}\PY{p}{,} \PY{n}{preds}\PY{p}{,} \PY{n}{display\PYZus{}labels}\PY{o}{=}\PY{n}{classNames}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}
    \PY{p}{)}


\PY{n}{preds} \PY{o}{=} \PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{XTest}\PY{p}{)}
\PY{n}{preds} \PY{o}{=} \PY{n}{preds}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}

\PY{n}{classStats}\PY{p}{(}\PY{n}{yTest}\PY{p}{,} \PY{n}{preds}\PY{p}{,} \PY{n}{classNames}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{313/313} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 972us/step
              precision    recall  f1-score   support

           0       0.84      0.82      0.83      1000
           1       0.99      0.96      0.98      1000
           2       0.75      0.83      0.79      1000
           3       0.80      0.93      0.86      1000
           4       0.79      0.80      0.79      1000
           5       0.89      0.98      0.93      1000
           6       0.78      0.57      0.66      1000
           7       0.95      0.90      0.92      1000
           8       0.94      0.97      0.95      1000
           9       0.97      0.94      0.95      1000

    accuracy                           0.87     10000
   macro avg       0.87      0.87      0.87     10000
weighted avg       0.87      0.87      0.87     10000

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Neural Networks_files/Neural Networks_22_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
If the training data was very skewed, with over/under-representation of
some classes you can set the \texttt{class\_weight} argument in the
\texttt{fit} method to give a larger weight to underpresented classes
and a smaller weight to overrepresented classes. This is used when
computing loss during training, so the model gives more importance to
underrepresented classes. If per instance weights are needed the
\texttt{sample\_weight} argument can be used. When both
\texttt{class\_weight} and \texttt{sample\_weight} are used the weights
are multiplied. For example if you wanted to give more weight to more
recent data you could use \texttt{sample\_weight} and if you wanted to
give more weight to underrepresented classes you could use
\texttt{class\_weight}.

The \texttt{fit()} method returns a \texttt{History} object containing
the training parameters (\texttt{history.params}), the list of epochs it
went through (\texttt{history.epoch}) and a dictionary
(\texttt{history.history}) containing the loss and extra metrics it
measured at the end of each epoch on the training set and on the
validation set. You can use the \texttt{history.history} dictionary to
plot the learning curves.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{pandas}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{pd}

\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{hist}\PY{o}{.}\PY{n}{history}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{,}
    \PY{n}{xlim}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{29}\PY{p}{]}\PY{p}{,}
    \PY{n}{ylim}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
    \PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{n}{xlabel}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Epoch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{style}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{r\PYZhy{}\PYZhy{}.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{r\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{b\PYZhy{}*}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{b\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<Axes: xlabel='Epoch'>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Neural Networks_files/Neural Networks_24_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{hist} \PY{o}{=} \PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain}\PY{p}{,} \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{n}{XValid}\PY{p}{,} \PY{n}{yValid}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/5
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9135 - loss: 0.2446 - val\_accuracy: 0.8724 - val\_loss: 0.3561
Epoch 2/5
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 1ms/step -
accuracy: 0.9147 - loss: 0.2414 - val\_accuracy: 0.8734 - val\_loss: 0.3570
Epoch 3/5
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 1ms/step -
accuracy: 0.9158 - loss: 0.2381 - val\_accuracy: 0.8736 - val\_loss: 0.3571
Epoch 4/5
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9167 - loss: 0.2350 - val\_accuracy: 0.8730 - val\_loss: 0.3584
Epoch 5/5
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{3s} 2ms/step -
accuracy: 0.9178 - loss: 0.2319 - val\_accuracy: 0.8734 - val\_loss: 0.3590
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{preds} \PY{o}{=} \PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{XTest}\PY{p}{)}
\PY{n}{preds} \PY{o}{=} \PY{n}{preds}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}

\PY{n}{display}\PY{p}{(}\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{n}{XTest}\PY{p}{,} \PY{n}{yTest}\PY{p}{)}\PY{p}{)}
\PY{n}{classStats}\PY{p}{(}\PY{n}{yTest}\PY{p}{,} \PY{n}{preds}\PY{p}{,} \PY{n}{classNames}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{313/313} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 903us/step
\textbf{313/313} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 829us/step -
accuracy: 0.8727 - loss: 0.3713
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
[0.3727381229400635, 0.8705000281333923]
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
              precision    recall  f1-score   support

           0       0.84      0.81      0.83      1000
           1       0.99      0.96      0.98      1000
           2       0.76      0.84      0.79      1000
           3       0.81      0.92      0.86      1000
           4       0.79      0.82      0.80      1000
           5       0.88      0.98      0.93      1000
           6       0.79      0.57      0.66      1000
           7       0.95      0.89      0.92      1000
           8       0.94      0.97      0.96      1000
           9       0.97      0.94      0.95      1000

    accuracy                           0.87     10000
   macro avg       0.87      0.87      0.87     10000
weighted avg       0.87      0.87      0.87     10000

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Neural Networks_files/Neural Networks_26_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{hist}\PY{o}{.}\PY{n}{history}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{,}
    \PY{n}{xlim}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{]}\PY{p}{,}
    \PY{n}{ylim}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
    \PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{n}{xlabel}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Epoch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{style}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{r\PYZhy{}\PYZhy{}.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{r\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{b\PYZhy{}*}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{b\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<Axes: xlabel='Epoch'>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Neural Networks_files/Neural Networks_27_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
\subsection{Building a Regression MLP using the Sequential
API}\label{building-a-regression-mlp-using-the-sequential-api}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{utils}\PY{o}{.}\PY{n}{set\PYZus{}random\PYZus{}seed}\PY{p}{(}\PY{l+m+mi}{42}\PY{p}{)}

\PY{n}{housing} \PY{o}{=} \PY{n}{fetch\PYZus{}california\PYZus{}housing}\PY{p}{(}\PY{p}{)}
\PY{n}{XTrainFull}\PY{p}{,} \PY{n}{XTest}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{,} \PY{n}{yTest} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
    \PY{n}{housing}\PY{o}{.}\PY{n}{data}\PY{p}{,} \PY{n}{housing}\PY{o}{.}\PY{n}{target}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}
\PY{p}{)}
\PY{n}{XTrain}\PY{p}{,} \PY{n}{XValid}\PY{p}{,} \PY{n}{yTrain}\PY{p}{,} \PY{n}{yValid} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
    \PY{n}{XTrainFull}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{norm} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Normalization}\PY{p}{(}\PY{p}{)}

\PY{n}{reg} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Sequential}\PY{p}{(}
    \PY{p}{[}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{n}{XTrain}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{)}\PY{p}{,}
        \PY{n}{norm}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}
    \PY{p}{]}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{opt} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{Adam}\PY{p}{(}\PY{n}{learning\PYZus{}rate}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{)}

\PY{n}{reg}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{n}{loss}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mse}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{optimizer}\PY{o}{=}\PY{n}{opt}\PY{p}{,} \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RootMeanSquaredError}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{reg}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{Model: "sequential\_2"}

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃\textbf{ }\textbf{Layer (type)                   }\textbf{ }┃\textbf{ }\textbf{Output Shape          }\textbf{ }┃\textbf{ }\textbf{      Param \#}\textbf{ }┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ normalization (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Normalization})   │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{8})              │            \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{17} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_6 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                 │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{50})             │           \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{450} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_7 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                 │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{50})             │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{2,550} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_8 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                 │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{50})             │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{2,550} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_9 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                 │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1})              │            \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{51} │
└─────────────────────────────────┴────────────────────────┴───────────────┘

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Total params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{5,618} (21.95 KB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{5,601} (21.88 KB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Non-trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{17} (72.00 B)

    \end{Verbatim}

    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{norm}\PY{o}{.}\PY{n}{adapt}\PY{p}{(}\PY{n}{XTrain}\PY{p}{)}
\PY{n}{hist} \PY{o}{=} \PY{n}{reg}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain}\PY{p}{,} \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{,} \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{n}{XValid}\PY{p}{,} \PY{n}{yValid}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{1s} 1ms/step -
RootMeanSquaredError: 1.2143 - loss: 1.5762 - val\_RootMeanSquaredError: 0.6527 -
val\_loss: 0.4261
Epoch 2/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 944us/step -
RootMeanSquaredError: 0.6372 - loss: 0.4066 - val\_RootMeanSquaredError: 0.5933 -
val\_loss: 0.3521
Epoch 3/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6074 - loss: 0.3692 - val\_RootMeanSquaredError: 0.6970 -
val\_loss: 0.4858
Epoch 4/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5922 - loss: 0.3509 - val\_RootMeanSquaredError: 0.7863 -
val\_loss: 0.6183
Epoch 5/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 995us/step -
RootMeanSquaredError: 0.5808 - loss: 0.3375 - val\_RootMeanSquaredError: 1.1434 -
val\_loss: 1.3074
Epoch 6/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 994us/step -
RootMeanSquaredError: 0.5719 - loss: 0.3272 - val\_RootMeanSquaredError: 1.3506 -
val\_loss: 1.8242
Epoch 7/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5658 - loss: 0.3202 - val\_RootMeanSquaredError: 0.7185 -
val\_loss: 0.5162
Epoch 8/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 989us/step -
RootMeanSquaredError: 0.5564 - loss: 0.3096 - val\_RootMeanSquaredError: 0.8469 -
val\_loss: 0.7172
Epoch 9/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5513 - loss: 0.3040 - val\_RootMeanSquaredError: 0.6418 -
val\_loss: 0.4119
Epoch 10/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5463 - loss: 0.2985 - val\_RootMeanSquaredError: 0.6756 -
val\_loss: 0.4564
Epoch 11/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5426 - loss: 0.2944 - val\_RootMeanSquaredError: 0.7295 -
val\_loss: 0.5321
Epoch 12/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5396 - loss: 0.2912 - val\_RootMeanSquaredError: 1.0084 -
val\_loss: 1.0169
Epoch 13/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5377 - loss: 0.2891 - val\_RootMeanSquaredError: 0.6520 -
val\_loss: 0.4251
Epoch 14/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5341 - loss: 0.2853 - val\_RootMeanSquaredError: 1.0415 -
val\_loss: 1.0847
Epoch 15/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 974us/step -
RootMeanSquaredError: 0.5318 - loss: 0.2828 - val\_RootMeanSquaredError: 0.7899 -
val\_loss: 0.6239
Epoch 16/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5298 - loss: 0.2807 - val\_RootMeanSquaredError: 1.1863 -
val\_loss: 1.4073
Epoch 17/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 979us/step -
RootMeanSquaredError: 0.5282 - loss: 0.2790 - val\_RootMeanSquaredError: 0.5334 -
val\_loss: 0.2845
Epoch 18/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 953us/step -
RootMeanSquaredError: 0.5241 - loss: 0.2748 - val\_RootMeanSquaredError: 0.5660 -
val\_loss: 0.3204
Epoch 19/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 946us/step -
RootMeanSquaredError: 0.5215 - loss: 0.2720 - val\_RootMeanSquaredError: 0.5181 -
val\_loss: 0.2684
Epoch 20/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 953us/step -
RootMeanSquaredError: 0.5194 - loss: 0.2698 - val\_RootMeanSquaredError: 0.5378 -
val\_loss: 0.2893
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{mse}\PY{p}{,} \PY{n}{rmse} \PY{o}{=} \PY{n}{reg}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{n}{XTest}\PY{p}{,} \PY{n}{yTest}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{162/162} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 603us/step -
RootMeanSquaredError: 0.5235 - loss: 0.2742
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{XNew} \PY{o}{=} \PY{n}{XTest}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{3}\PY{p}{]}
\PY{n}{preds} \PY{o}{=} \PY{n}{reg}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{XNew}\PY{p}{)}
\PY{n}{preds}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{1/1} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 51ms/step
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
array([[0.47],
       [1.2 ],
       [4.8 ]], dtype=float32)
\end{Verbatim}
\end{tcolorbox}
        
\subsection{Building Complex Models using the Functional
API}\label{building-complex-models-using-the-functional-api}

An example of a non-sequential neural network is a \emph{Wide \& Deep}
neural network, where all or part of the inputs are connected directly
to the output layer. This makes it possible for the network to learn
both deep patterns (using the deep path) and simple rules (through the
short path). In contrast a regular MLP forces all the data to flow
through the deep path, thus simple patterns in the data may end up being
distorted by this sequence of transformations.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{functools}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{partial}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{tensorflow}\PY{n+nn}{.}\PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{Normalization}\PY{p}{,} \PY{n}{Dense}\PY{p}{,} \PY{n}{Concatenate}\PY{p}{,} \PY{n}{Input}

\PY{n}{hidLay} \PY{o}{=} \PY{n}{partial}\PY{p}{(}\PY{n}{Dense}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{30}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{normLayer} \PY{o}{=} \PY{n}{Normalization}\PY{p}{(}\PY{p}{)}
\PY{n}{hidLay1} \PY{o}{=} \PY{n}{hidLay}\PY{p}{(}\PY{p}{)}
\PY{n}{hidLay2} \PY{o}{=} \PY{n}{hidLay}\PY{p}{(}\PY{p}{)}
\PY{n}{concatLayer} \PY{o}{=} \PY{n}{Concatenate}\PY{p}{(}\PY{p}{)}
\PY{n}{outputLayer} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}

\PY{n}{input\PYZus{}} \PY{o}{=} \PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{n}{XTrain}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{)}
\PY{n}{normed} \PY{o}{=} \PY{n}{normLayer}\PY{p}{(}\PY{n}{input\PYZus{}}\PY{p}{)}
\PY{n}{hid1} \PY{o}{=} \PY{n}{hidLay1}\PY{p}{(}\PY{n}{normed}\PY{p}{)}
\PY{n}{hid2} \PY{o}{=} \PY{n}{hidLay2}\PY{p}{(}\PY{n}{hid1}\PY{p}{)}
\PY{n}{concat} \PY{o}{=} \PY{n}{concatLayer}\PY{p}{(}\PY{p}{[}\PY{n}{normed}\PY{p}{,} \PY{n}{hid2}\PY{p}{]}\PY{p}{)}
\PY{n}{output} \PY{o}{=} \PY{n}{outputLayer}\PY{p}{(}\PY{n}{concat}\PY{p}{)}

\PY{n}{regWide} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Model}\PY{p}{(}\PY{n}{inputs}\PY{o}{=}\PY{p}{[}\PY{n}{input\PYZus{}}\PY{p}{]}\PY{p}{,} \PY{n}{outputs}\PY{o}{=}\PY{p}{[}\PY{n}{output}\PY{p}{]}\PY{p}{)}
\PY{n}{regWide}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{Model: "functional\_7"}

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃\textbf{ }\textbf{Layer (type)       }\textbf{ }┃\textbf{ }\textbf{Output Shape     }\textbf{ }┃\textbf{ }\textbf{   Param \#}\textbf{ }┃\textbf{ }\textbf{Connected to     }\textbf{ }┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ input\_layer\_3       │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{8})         │          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │ -                 │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{InputLayer})        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ normalization\_1     │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{8})         │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{17} │ input\_layer\_3[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]… │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Normalization})     │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense\_10 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})    │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{30})        │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{270} │ normalization\_1[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{…} │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense\_11 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})    │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{30})        │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{930} │ dense\_10[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ concatenate         │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{38})        │          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │ normalization\_1[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{…} │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Concatenate})       │                   │            │ dense\_11[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense\_12 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})    │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1})         │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{39} │ concatenate[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}] │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Total params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,256} (4.91 KB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,239} (4.84 KB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Non-trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{17} (72.00 B)

    \end{Verbatim}

    
\begin{itemize}
\item
  First we create five layers: a \texttt{Normalization} layer to
  standardize inputs, two \texttt{Dense} layers with 30 neurons each
  using the \(\text{ReLU}\) activation function, a \texttt{Concatenate}
  layer, and one more \texttt{Dense} layer with a single output layer
  without any activation function.
\item
  Next we create an \texttt{Input} object, specifying the shape and
  dtype of the inputs. This is used as a function, passing it the
  inputs.
\item
  Then we pass the \texttt{Normalization} layer just like a function,
  passing the \texttt{Input} layer. The passing of layers as arguments
  to other layers only serves to connect them together.
\item
  We pass \texttt{normed} to \texttt{hidLay1}, which outputs
  \texttt{hid1} and we pass \texttt{hid1} to \texttt{hidLay2}, which
  outputs \texttt{hid2}.
\item
  So far all the connections have been sequential, but then we use
  \texttt{concatLayer} to concatenate the input and second hidden
  layer's output
\item
  Then pass \texttt{concat} to the \texttt{outputLayer} which finally
  gives us \texttt{output}.
\item
  Finally we create a Keras model, specifying which inputs and outputs
  to use.
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{opt} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{Adam}\PY{p}{(}\PY{n}{learning\PYZus{}rate}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{)}
\PY{n}{regWide}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{n}{loss}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mse}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{optimizer}\PY{o}{=}\PY{n}{opt}\PY{p}{,} \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RootMeanSquaredError}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{normLayer}\PY{o}{.}\PY{n}{adapt}\PY{p}{(}\PY{n}{XTrain}\PY{p}{)}
\PY{n}{hist} \PY{o}{=} \PY{n}{regWide}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain}\PY{p}{,} \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{,} \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{n}{XValid}\PY{p}{,} \PY{n}{yValid}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{1s} 1ms/step -
RootMeanSquaredError: 1.4678 - loss: 2.2793 - val\_RootMeanSquaredError: 2.9178 -
val\_loss: 8.5133
Epoch 2/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 882us/step -
RootMeanSquaredError: 0.7139 - loss: 0.5107 - val\_RootMeanSquaredError: 1.7047 -
val\_loss: 2.9059
Epoch 3/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 900us/step -
RootMeanSquaredError: 0.6398 - loss: 0.4096 - val\_RootMeanSquaredError: 1.0166 -
val\_loss: 1.0334
Epoch 4/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 945us/step -
RootMeanSquaredError: 0.6173 - loss: 0.3812 - val\_RootMeanSquaredError: 0.6176 -
val\_loss: 0.3815
Epoch 5/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 939us/step -
RootMeanSquaredError: 0.6050 - loss: 0.3662 - val\_RootMeanSquaredError: 0.5938 -
val\_loss: 0.3526
Epoch 6/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 910us/step -
RootMeanSquaredError: 0.5967 - loss: 0.3562 - val\_RootMeanSquaredError: 0.5811 -
val\_loss: 0.3377
Epoch 7/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 890us/step -
RootMeanSquaredError: 0.5902 - loss: 0.3485 - val\_RootMeanSquaredError: 0.5746 -
val\_loss: 0.3301
Epoch 8/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 884us/step -
RootMeanSquaredError: 0.5838 - loss: 0.3409 - val\_RootMeanSquaredError: 0.5665 -
val\_loss: 0.3209
Epoch 9/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 909us/step -
RootMeanSquaredError: 0.5788 - loss: 0.3351 - val\_RootMeanSquaredError: 0.5610 -
val\_loss: 0.3147
Epoch 10/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 883us/step -
RootMeanSquaredError: 0.5745 - loss: 0.3302 - val\_RootMeanSquaredError: 0.5579 -
val\_loss: 0.3113
Epoch 11/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 878us/step -
RootMeanSquaredError: 0.5712 - loss: 0.3264 - val\_RootMeanSquaredError: 0.5627 -
val\_loss: 0.3166
Epoch 12/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 884us/step -
RootMeanSquaredError: 0.5684 - loss: 0.3232 - val\_RootMeanSquaredError: 0.5619 -
val\_loss: 0.3158
Epoch 13/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 883us/step -
RootMeanSquaredError: 0.5652 - loss: 0.3196 - val\_RootMeanSquaredError: 0.6016 -
val\_loss: 0.3620
Epoch 14/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 875us/step -
RootMeanSquaredError: 0.5624 - loss: 0.3164 - val\_RootMeanSquaredError: 0.5646 -
val\_loss: 0.3187
Epoch 15/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 876us/step -
RootMeanSquaredError: 0.5596 - loss: 0.3133 - val\_RootMeanSquaredError: 0.7858 -
val\_loss: 0.6175
Epoch 16/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 957us/step -
RootMeanSquaredError: 0.5574 - loss: 0.3108 - val\_RootMeanSquaredError: 0.6477 -
val\_loss: 0.4196
Epoch 17/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 937us/step -
RootMeanSquaredError: 0.5553 - loss: 0.3084 - val\_RootMeanSquaredError: 1.1061 -
val\_loss: 1.2234
Epoch 18/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 915us/step -
RootMeanSquaredError: 0.5533 - loss: 0.3063 - val\_RootMeanSquaredError: 0.6701 -
val\_loss: 0.4490
Epoch 19/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 897us/step -
RootMeanSquaredError: 0.5516 - loss: 0.3044 - val\_RootMeanSquaredError: 1.7290 -
val\_loss: 2.9895
Epoch 20/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 954us/step -
RootMeanSquaredError: 0.5539 - loss: 0.3069 - val\_RootMeanSquaredError: 1.9701 -
val\_loss: 3.8811
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{regWide}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{n}{XTest}\PY{p}{,} \PY{n}{yTest}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{162/162} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 544us/step -
RootMeanSquaredError: 0.5631 - loss: 0.3174
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
[0.31699109077453613, 0.5630196332931519]
\end{Verbatim}
\end{tcolorbox}
        
In passing different subsets of features along different paths in the
network multiple inputs could be used.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{inputWide} \PY{o}{=} \PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputWide}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{inputDeep} \PY{o}{=} \PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{6}\PY{p}{]}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputDeep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{normLayerWide} \PY{o}{=} \PY{n}{Normalization}\PY{p}{(}\PY{p}{)}
\PY{n}{normLayerDeep} \PY{o}{=} \PY{n}{Normalization}\PY{p}{(}\PY{p}{)}

\PY{n}{normWide} \PY{o}{=} \PY{n}{normLayerWide}\PY{p}{(}\PY{n}{inputWide}\PY{p}{)}
\PY{n}{normDeep} \PY{o}{=} \PY{n}{normLayerDeep}\PY{p}{(}\PY{n}{inputDeep}\PY{p}{)}

\PY{n}{hid1} \PY{o}{=} \PY{n}{hidLay}\PY{p}{(}\PY{p}{)}\PY{p}{(}\PY{n}{normDeep}\PY{p}{)}
\PY{n}{hid2} \PY{o}{=} \PY{n}{hidLay}\PY{p}{(}\PY{p}{)}\PY{p}{(}\PY{n}{hid1}\PY{p}{)}

\PY{n}{concat} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{normWide}\PY{p}{,} \PY{n}{hid2}\PY{p}{]}\PY{p}{)}

\PY{n}{output} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{output}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{(}\PY{n}{concat}\PY{p}{)}

\PY{n}{regWide} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Model}\PY{p}{(}\PY{n}{inputs}\PY{o}{=}\PY{p}{[}\PY{n}{inputWide}\PY{p}{,} \PY{n}{inputDeep}\PY{p}{]}\PY{p}{,} \PY{n}{outputs}\PY{o}{=}\PY{p}{[}\PY{n}{output}\PY{p}{]}\PY{p}{)}
\PY{n}{regWide}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{Model: "functional\_9"}

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃\textbf{ }\textbf{Layer (type)       }\textbf{ }┃\textbf{ }\textbf{Output Shape     }\textbf{ }┃\textbf{ }\textbf{   Param \#}\textbf{ }┃\textbf{ }\textbf{Connected to     }\textbf{ }┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ inputDeep           │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{6})         │          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │ -                 │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{InputLayer})        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ normalization\_3     │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{6})         │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{13} │ inputDeep[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]   │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Normalization})     │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ inputWide           │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{5})         │          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │ -                 │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{InputLayer})        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense\_13 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})    │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{30})        │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{210} │ normalization\_3[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{…} │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ normalization\_2     │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{5})         │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{11} │ inputWide[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]   │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Normalization})     │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense\_14 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})    │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{30})        │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{930} │ dense\_13[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ concatenate\_1       │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{35})        │          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │ normalization\_2[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{…} │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Concatenate})       │                   │            │ dense\_14[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ output (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})      │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1})         │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{36} │ concatenate\_1[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]… │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Total params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,200} (4.70 KB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,176} (4.59 KB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Non-trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{24} (104.00 B)

    \end{Verbatim}

    
\begin{itemize}
\item
  Each \texttt{Dense} layer is created and called on the same line as is
  common practice. However this isn't done with the
  \texttt{Normalization} layers as a reference to the layer is needed
  for adaptation.
\item
  Used \texttt{tf.keras.layers.concatenate} to concatenate the inputs
  and the output of the second hidden layer.
\item
  We specified two inputs when creating the model as there are two
  inputs.
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{opt} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{Adam}\PY{p}{(}\PY{n}{learning\PYZus{}rate}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{)}
\PY{n}{regWide}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{n}{loss}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mse}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{optimizer}\PY{o}{=}\PY{n}{opt}\PY{p}{,} \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RootMeanSquaredError}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{XTrainWide}\PY{p}{,} \PY{n}{XTrainDeep} \PY{o}{=} \PY{n}{XTrain}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{XTrain}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}
\PY{n}{XValidWide}\PY{p}{,} \PY{n}{XValidDeep} \PY{o}{=} \PY{n}{XValid}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{XValid}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}
\PY{n}{XTestWide}\PY{p}{,} \PY{n}{XTestDeep} \PY{o}{=} \PY{n}{XTest}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{XTest}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}
\PY{n}{XNewWide}\PY{p}{,} \PY{n}{XNewDeep} \PY{o}{=} \PY{n}{XTestWide}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{,} \PY{n}{XTestDeep}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{3}\PY{p}{]}

\PY{n}{normLayerWide}\PY{o}{.}\PY{n}{adapt}\PY{p}{(}\PY{n}{XTrainWide}\PY{p}{)}
\PY{n}{normLayerDeep}\PY{o}{.}\PY{n}{adapt}\PY{p}{(}\PY{n}{XTrainDeep}\PY{p}{)}

\PY{n}{hist} \PY{o}{=} \PY{n}{regWide}\PY{o}{.}\PY{n}{fit}\PY{p}{(}
    \PY{p}{(}\PY{n}{XTrainWide}\PY{p}{,} \PY{n}{XTrainDeep}\PY{p}{)}\PY{p}{,}
    \PY{n}{yTrain}\PY{p}{,}
    \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{p}{(}\PY{n}{XValidWide}\PY{p}{,} \PY{n}{XValidDeep}\PY{p}{)}\PY{p}{,} \PY{n}{yValid}\PY{p}{)}\PY{p}{,}
    \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{1s} 1ms/step -
RootMeanSquaredError: 1.7786 - loss: 3.2631 - val\_RootMeanSquaredError: 0.9088 -
val\_loss: 0.8260
Epoch 2/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 953us/step -
RootMeanSquaredError: 0.8502 - loss: 0.7241 - val\_RootMeanSquaredError: 0.9169 -
val\_loss: 0.8408
Epoch 3/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 930us/step -
RootMeanSquaredError: 0.7640 - loss: 0.5841 - val\_RootMeanSquaredError: 0.8662 -
val\_loss: 0.7503
Epoch 4/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 943us/step -
RootMeanSquaredError: 0.7125 - loss: 0.5081 - val\_RootMeanSquaredError: 0.9910 -
val\_loss: 0.9821
Epoch 5/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 946us/step -
RootMeanSquaredError: 0.6711 - loss: 0.4506 - val\_RootMeanSquaredError: 0.9600 -
val\_loss: 0.9216
Epoch 6/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 959us/step -
RootMeanSquaredError: 0.6402 - loss: 0.4101 - val\_RootMeanSquaredError: 0.8299 -
val\_loss: 0.6888
Epoch 7/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6181 - loss: 0.3821 - val\_RootMeanSquaredError: 1.3156 -
val\_loss: 1.7309
Epoch 8/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 973us/step -
RootMeanSquaredError: 0.6084 - loss: 0.3702 - val\_RootMeanSquaredError: 1.4480 -
val\_loss: 2.0968
Epoch 9/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6010 - loss: 0.3612 - val\_RootMeanSquaredError: 1.2405 -
val\_loss: 1.5388
Epoch 10/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5949 - loss: 0.3541 - val\_RootMeanSquaredError: 1.3897 -
val\_loss: 1.9313
Epoch 11/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5920 - loss: 0.3506 - val\_RootMeanSquaredError: 1.3386 -
val\_loss: 1.7919
Epoch 12/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5907 - loss: 0.3490 - val\_RootMeanSquaredError: 1.2488 -
val\_loss: 1.5596
Epoch 13/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5863 - loss: 0.3438 - val\_RootMeanSquaredError: 0.9414 -
val\_loss: 0.8862
Epoch 14/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 980us/step -
RootMeanSquaredError: 0.5836 - loss: 0.3407 - val\_RootMeanSquaredError: 0.9483 -
val\_loss: 0.8992
Epoch 15/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 966us/step -
RootMeanSquaredError: 0.5806 - loss: 0.3372 - val\_RootMeanSquaredError: 0.9576 -
val\_loss: 0.9170
Epoch 16/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 914us/step -
RootMeanSquaredError: 0.5799 - loss: 0.3364 - val\_RootMeanSquaredError: 1.0987 -
val\_loss: 1.2072
Epoch 17/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 933us/step -
RootMeanSquaredError: 0.5794 - loss: 0.3357 - val\_RootMeanSquaredError: 1.0939 -
val\_loss: 1.1966
Epoch 18/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 903us/step -
RootMeanSquaredError: 0.5778 - loss: 0.3339 - val\_RootMeanSquaredError: 1.2056 -
val\_loss: 1.4534
Epoch 19/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 914us/step -
RootMeanSquaredError: 0.5776 - loss: 0.3337 - val\_RootMeanSquaredError: 1.1802 -
val\_loss: 1.3928
Epoch 20/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 926us/step -
RootMeanSquaredError: 0.5764 - loss: 0.3323 - val\_RootMeanSquaredError: 1.2530 -
val\_loss: 1.5700
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{mseTest} \PY{o}{=} \PY{n}{regWide}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{p}{(}\PY{n}{XTestWide}\PY{p}{,} \PY{n}{XTestDeep}\PY{p}{)}\PY{p}{,} \PY{n}{yTest}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{162/162} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 557us/step -
RootMeanSquaredError: 0.5803 - loss: 0.3369
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{preds} \PY{o}{=} \PY{n}{regWide}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{p}{(}\PY{n}{XNewWide}\PY{p}{,} \PY{n}{XNewDeep}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{1/1} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 52ms/step
    \end{Verbatim}

There are also cases where you may want to have multiple outputs:

\begin{itemize}
\item
  The task demands it, like locating and classifying, the main object in
  a picture, which is both a regression and classification task
\item
  You have multiple independent tasks based on the same data. For
  example performing \emph{multitask classification} on pictures of
  faces, using one output to classify the person's facial expression and
  another output to identify if the person is wearing glasses or not.
\item
  As a regularization technique. For example you may want to add an
  auxiliary output to a network architecture to ensure the underlying
  part of the network learns something useful on it's own, without
  relying on the rest of the network.
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{aux} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{aux}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{(}\PY{n}{hid2}\PY{p}{)}
\PY{n}{regWide} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Model}\PY{p}{(}
    \PY{n}{inputs}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputDeep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{inputDeep}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputWide}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{inputWide}\PY{p}{\PYZcb{}}\PY{p}{,} \PY{n}{outputs}\PY{o}{=}\PY{p}{[}\PY{n}{output}\PY{p}{,} \PY{n}{aux}\PY{p}{]}
\PY{p}{)}
\PY{n}{opt} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{Adam}\PY{p}{(}\PY{n}{learning\PYZus{}rate}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{)}
\PY{n}{regWide}\PY{o}{.}\PY{n}{compile}\PY{p}{(}
    \PY{n}{loss}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{output}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mse}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{aux}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mse}\PY{l+s+s2}{\PYZdq{}}\PY{p}{\PYZcb{}}\PY{p}{,}
    \PY{n}{loss\PYZus{}weights}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{output}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+m+mf}{0.9}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{aux}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+m+mf}{0.1}\PY{p}{\PYZcb{}}\PY{p}{,}
    \PY{n}{optimizer}\PY{o}{=}\PY{n}{opt}\PY{p}{,}
    \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RootMeanSquaredError}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RootMeanSquaredError}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
\PY{p}{)}
\PY{n}{regWide}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{Model: "functional\_11"}

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃\textbf{ }\textbf{Layer (type)       }\textbf{ }┃\textbf{ }\textbf{Output Shape     }\textbf{ }┃\textbf{ }\textbf{   Param \#}\textbf{ }┃\textbf{ }\textbf{Connected to     }\textbf{ }┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ inputDeep           │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{6})         │          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │ -                 │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{InputLayer})        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ normalization\_3     │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{6})         │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{13} │ inputDeep[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]   │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Normalization})     │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ inputWide           │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{5})         │          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │ -                 │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{InputLayer})        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense\_13 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})    │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{30})        │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{210} │ normalization\_3[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{…} │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ normalization\_2     │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{5})         │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{11} │ inputWide[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]   │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Normalization})     │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense\_14 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})    │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{30})        │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{930} │ dense\_13[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ concatenate\_1       │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{35})        │          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │ normalization\_2[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{…} │
│ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Concatenate})       │                   │            │ dense\_14[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ output (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})      │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1})         │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{36} │ concatenate\_1[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ aux (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})         │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1})         │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{31} │ dense\_14[\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}][\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0}]    │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Total params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,231} (4.82 KB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,207} (4.71 KB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Non-trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{24} (104.00 B)

    \end{Verbatim}

    
Each output will need it's own loss function, so have to pass a list of
losses. By default Keras assigns each loss an equal weight, but since we
are more interested in the main output we can give it a higher weight.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{normLayerDeep}\PY{o}{.}\PY{n}{adapt}\PY{p}{(}\PY{n}{XTrainDeep}\PY{p}{)}
\PY{n}{normLayerWide}\PY{o}{.}\PY{n}{adapt}\PY{p}{(}\PY{n}{XTrainWide}\PY{p}{)}

\PY{n}{ytrains} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{output}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{yTrain}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{aux}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{yTrain}\PY{p}{\PYZcb{}}
\PY{n}{xtrains} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputDeep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{XTrainDeep}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputWide}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{XTrainWide}\PY{p}{\PYZcb{}}
\PY{n}{xvals} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputDeep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{XValidDeep}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputWide}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{XValidWide}\PY{p}{\PYZcb{}}
\PY{n}{yvals} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{output}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{yValid}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{aux}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{yValid}\PY{p}{\PYZcb{}}
\PY{n}{xtests} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputDeep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{XTestDeep}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputWide}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{XTestWide}\PY{p}{\PYZcb{}}
\PY{n}{ytests} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{output}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{yTest}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{aux}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{yTest}\PY{p}{\PYZcb{}}
\PY{n}{hist} \PY{o}{=} \PY{n}{regWide}\PY{o}{.}\PY{n}{fit}\PY{p}{(}
    \PY{n}{xtrains}\PY{p}{,}
    \PY{n}{ytrains}\PY{p}{,}
    \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{,}
    \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{n}{xvals}\PY{p}{,} \PY{n}{yvals}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{1s} 1ms/step -
aux\_RootMeanSquaredError: 1.3624 - loss: 0.4962 - output\_RootMeanSquaredError:
0.5801 - val\_aux\_RootMeanSquaredError: 0.9054 - val\_loss: 0.5189 -
val\_output\_RootMeanSquaredError: 0.6967
Epoch 2/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.8021 - loss: 0.3629 - output\_RootMeanSquaredError:
0.5758 - val\_aux\_RootMeanSquaredError: 0.7498 - val\_loss: 0.6340 -
val\_output\_RootMeanSquaredError: 0.8012
Epoch 3/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.7388 - loss: 0.3517 - output\_RootMeanSquaredError:
0.5745 - val\_aux\_RootMeanSquaredError: 0.9372 - val\_loss: 0.7686 -
val\_output\_RootMeanSquaredError: 0.8697
Epoch 4/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.7108 - loss: 0.3452 - output\_RootMeanSquaredError:
0.5722 - val\_aux\_RootMeanSquaredError: 1.2409 - val\_loss: 1.1104 -
val\_output\_RootMeanSquaredError: 1.0309
Epoch 5/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6880 - loss: 0.3416 - output\_RootMeanSquaredError:
0.5717 - val\_aux\_RootMeanSquaredError: 1.2655 - val\_loss: 1.1496 -
val\_output\_RootMeanSquaredError: 1.0485
Epoch 6/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6728 - loss: 0.3397 - output\_RootMeanSquaredError:
0.5719 - val\_aux\_RootMeanSquaredError: 1.1427 - val\_loss: 1.1674 -
val\_output\_RootMeanSquaredError: 1.0733
Epoch 7/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6583 - loss: 0.3356 - output\_RootMeanSquaredError:
0.5698 - val\_aux\_RootMeanSquaredError: 1.0255 - val\_loss: 0.7857 -
val\_output\_RootMeanSquaredError: 0.8696
Epoch 8/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6489 - loss: 0.3334 - output\_RootMeanSquaredError:
0.5688 - val\_aux\_RootMeanSquaredError: 1.0503 - val\_loss: 0.8421 -
val\_output\_RootMeanSquaredError: 0.9017
Epoch 9/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6402 - loss: 0.3303 - output\_RootMeanSquaredError:
0.5669 - val\_aux\_RootMeanSquaredError: 0.9851 - val\_loss: 0.7459 -
val\_output\_RootMeanSquaredError: 0.8491
Epoch 10/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6334 - loss: 0.3282 - output\_RootMeanSquaredError:
0.5657 - val\_aux\_RootMeanSquaredError: 1.0902 - val\_loss: 0.8345 -
val\_output\_RootMeanSquaredError: 0.8917
Epoch 11/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6283 - loss: 0.3269 - output\_RootMeanSquaredError:
0.5651 - val\_aux\_RootMeanSquaredError: 1.0446 - val\_loss: 0.7880 -
val\_output\_RootMeanSquaredError: 0.8685
Epoch 12/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6251 - loss: 0.3268 - output\_RootMeanSquaredError:
0.5654 - val\_aux\_RootMeanSquaredError: 1.1686 - val\_loss: 0.9666 -
val\_output\_RootMeanSquaredError: 0.9603
Epoch 13/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6209 - loss: 0.3254 - output\_RootMeanSquaredError:
0.5644 - val\_aux\_RootMeanSquaredError: 1.1490 - val\_loss: 0.9162 -
val\_output\_RootMeanSquaredError: 0.9334
Epoch 14/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6200 - loss: 0.3270 - output\_RootMeanSquaredError:
0.5661 - val\_aux\_RootMeanSquaredError: 1.0984 - val\_loss: 0.9250 -
val\_output\_RootMeanSquaredError: 0.9454
Epoch 15/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6149 - loss: 0.3236 - output\_RootMeanSquaredError:
0.5634 - val\_aux\_RootMeanSquaredError: 1.0322 - val\_loss: 0.7635 -
val\_output\_RootMeanSquaredError: 0.8544
Epoch 16/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6116 - loss: 0.3220 - output\_RootMeanSquaredError:
0.5623 - val\_aux\_RootMeanSquaredError: 1.0857 - val\_loss: 0.8371 -
val\_output\_RootMeanSquaredError: 0.8940
Epoch 17/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6103 - loss: 0.3216 - output\_RootMeanSquaredError:
0.5620 - val\_aux\_RootMeanSquaredError: 1.0779 - val\_loss: 0.7986 -
val\_output\_RootMeanSquaredError: 0.8708
Epoch 18/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6108 - loss: 0.3229 - output\_RootMeanSquaredError:
0.5632 - val\_aux\_RootMeanSquaredError: 0.9940 - val\_loss: 0.8047 -
val\_output\_RootMeanSquaredError: 0.8856
Epoch 19/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6059 - loss: 0.3202 - output\_RootMeanSquaredError:
0.5612 - val\_aux\_RootMeanSquaredError: 0.9897 - val\_loss: 0.7214 -
val\_output\_RootMeanSquaredError: 0.8323
Epoch 20/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
aux\_RootMeanSquaredError: 0.6049 - loss: 0.3183 - output\_RootMeanSquaredError:
0.5594 - val\_aux\_RootMeanSquaredError: 1.0551 - val\_loss: 0.6691 -
val\_output\_RootMeanSquaredError: 0.7872
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{evalRes} \PY{o}{=} \PY{n}{regWide}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{n}{xtests}\PY{p}{,} \PY{n}{ytests}\PY{p}{)}
\PY{n}{mainLoss}\PY{p}{,} \PY{n}{wSumLoss}\PY{p}{,} \PY{n}{mainRmse} \PY{o}{=} \PY{n}{evalRes}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{162/162} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 628us/step -
aux\_RootMeanSquaredError: 0.6172 - loss: 0.3291 - output\_RootMeanSquaredError:
0.5685
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{xnews} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputWide}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{XNewWide}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{inputDeep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{XNewDeep}\PY{p}{\PYZcb{}}
\PY{n}{preds} \PY{o}{=} \PY{n}{regWide}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{xnews}\PY{p}{)}
\PY{n}{preds} \PY{o}{=} \PY{n+nb}{dict}\PY{p}{(}\PY{n+nb}{zip}\PY{p}{(}\PY{n}{regWide}\PY{o}{.}\PY{n}{output\PYZus{}names}\PY{p}{,} \PY{n}{preds}\PY{p}{)}\PY{p}{)}
\PY{n}{preds}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{1/1} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 57ms/step
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\{'output': array([[0.47618163],
        [0.71396697],
        [3.7181835 ]], dtype=float32),
 'aux': array([[0.4587401],
        [0.685268 ],
        [3.588437 ]], dtype=float32)\}
\end{Verbatim}
\end{tcolorbox}
        
\subsection{Using Subclassing API to build Dynamic
Models}\label{using-subclassing-api-to-build-dynamic-models}

The \texttt{Sequential} and \texttt{Functional} APIs are declarative,
meaning you declare the layers and how they are connected, then you pass
the data to the model and it does the rest. The \texttt{Subclassing} API
is more dynamic, allowing you to do pretty much anything you want. With
this approach you inherit from the \texttt{Model} class, create layers
in the constructor and use them to perform the computations in the
\texttt{call()} method. For example creating an instance of the
\texttt{WideAndDeepModel} class gives an equivalent model to the one
created using the \texttt{Functional} API.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{class}\PY{+w}{ }\PY{n+nc}{WideAndDeepModel}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Model}\PY{p}{)}\PY{p}{:}
    \PY{k}{def}\PY{+w}{ }\PY{n+nf+fm}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{30}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{o}{*}\PY{o}{*}\PY{n}{kwargs}\PY{p}{)}\PY{p}{:}
        \PY{n+nb}{super}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n+nf+fm}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{o}{*}\PY{o}{*}\PY{n}{kwargs}\PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{normLayerWide} \PY{o}{=} \PY{n}{Normalization}\PY{p}{(}\PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{normLayerDeep} \PY{o}{=} \PY{n}{Normalization}\PY{p}{(}\PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hiddLayer1} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{units}\PY{o}{=}\PY{n}{units}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{n}{activation}\PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hiddLayer2} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{units}\PY{o}{=}\PY{n}{units}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{n}{activation}\PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{mainOut} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{auxOut} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}

    \PY{k}{def}\PY{+w}{ }\PY{n+nf}{call}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{inputs}\PY{p}{)}\PY{p}{:}
        \PY{n}{inputWide}\PY{p}{,} \PY{n}{inputDeep} \PY{o}{=} \PY{n}{inputs}
        \PY{n}{normWide} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{normLayerWide}\PY{p}{(}\PY{n}{inputWide}\PY{p}{)}
        \PY{n}{normDeep} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{normLayerDeep}\PY{p}{(}\PY{n}{inputDeep}\PY{p}{)}
        \PY{n}{hidd1} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hiddLayer1}\PY{p}{(}\PY{n}{normDeep}\PY{p}{)}
        \PY{n}{hidd2} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hiddLayer2}\PY{p}{(}\PY{n}{hidd1}\PY{p}{)}
        \PY{n}{concat} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{normWide}\PY{p}{,} \PY{n}{hidd2}\PY{p}{]}\PY{p}{)}
        \PY{n}{output} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{mainOut}\PY{p}{(}\PY{n}{concat}\PY{p}{)}
        \PY{n}{auxOutput} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{auxOut}\PY{p}{(}\PY{n}{hidd2}\PY{p}{)}
        \PY{k}{return} \PY{n}{output}\PY{p}{,} \PY{n}{auxOutput}


\PY{n}{wideAndDeep} \PY{o}{=} \PY{n}{WideAndDeepModel}\PY{p}{(}\PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{WideAndDeep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{opt} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{Adam}\PY{p}{(}\PY{n}{learning\PYZus{}rate}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{)}
\PY{n}{wideAndDeep}\PY{o}{.}\PY{n}{compile}\PY{p}{(}
    \PY{n}{loss}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mse}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{loss\PYZus{}weights}\PY{o}{=}\PY{p}{[}\PY{l+m+mf}{0.9}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{]}\PY{p}{,}
    \PY{n}{optimizer}\PY{o}{=}\PY{n}{opt}\PY{p}{,}
    \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RootMeanSquaredError}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RootMeanSquaredError}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
\PY{p}{)}
\PY{n}{wideAndDeep}\PY{o}{.}\PY{n}{normLayerDeep}\PY{o}{.}\PY{n}{adapt}\PY{p}{(}\PY{n}{XTrainDeep}\PY{p}{)}
\PY{n}{wideAndDeep}\PY{o}{.}\PY{n}{normLayerWide}\PY{o}{.}\PY{n}{adapt}\PY{p}{(}\PY{n}{XTrainWide}\PY{p}{)}

\PY{n}{wideAndDeep}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{Model: "WideAndDeep"}

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃\textbf{ }\textbf{Layer (type)                   }\textbf{ }┃\textbf{ }\textbf{Output Shape          }\textbf{ }┃\textbf{ }\textbf{      Param \#}\textbf{ }┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ normalization\_4 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Normalization}) │ ?                      │            \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{11} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ normalization\_5 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Normalization}) │ ?                      │            \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{13} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_15 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ ?                      │   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} (unbuilt) │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_16 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ ?                      │   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} (unbuilt) │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_17 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ ?                      │   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} (unbuilt) │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_18 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ ?                      │   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} (unbuilt) │
└─────────────────────────────────┴────────────────────────┴───────────────┘

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Total params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{24} (104.00 B)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} (0.00 B)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Non-trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{24} (104.00 B)

    \end{Verbatim}

    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{hist} \PY{o}{=} \PY{n}{wideAndDeep}\PY{o}{.}\PY{n}{fit}\PY{p}{(}
    \PY{p}{(}\PY{n}{XTrainWide}\PY{p}{,} \PY{n}{XTrainDeep}\PY{p}{)}\PY{p}{,}
    \PY{n}{ytrains}\PY{p}{,}
    \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{,}
    \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{p}{(}\PY{n}{XValidWide}\PY{p}{,} \PY{n}{XValidDeep}\PY{p}{)}\PY{p}{,} \PY{n}{yvals}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{2s} 2ms/step -
RootMeanSquaredError: 1.6283 - RootMeanSquaredError\_1: 1.8672 - loss: 2.8192 -
val\_RootMeanSquaredError: 1.1792 - val\_RootMeanSquaredError\_1: 3.6576 -
val\_loss: 2.5892
Epoch 2/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.8252 - RootMeanSquaredError\_1: 1.0348 - loss: 0.7221 -
val\_RootMeanSquaredError: 0.6714 - val\_RootMeanSquaredError\_1: 2.3543 -
val\_loss: 0.9600
Epoch 3/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6889 - RootMeanSquaredError\_1: 0.8212 - loss: 0.4948 -
val\_RootMeanSquaredError: 0.6514 - val\_RootMeanSquaredError\_1: 1.5066 -
val\_loss: 0.6089
Epoch 4/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6580 - RootMeanSquaredError\_1: 0.7508 - loss: 0.4462 -
val\_RootMeanSquaredError: 0.6222 - val\_RootMeanSquaredError\_1: 1.1765 -
val\_loss: 0.4868
Epoch 5/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6409 - RootMeanSquaredError\_1: 0.7232 - loss: 0.4220 -
val\_RootMeanSquaredError: 0.7048 - val\_RootMeanSquaredError\_1: 0.8662 -
val\_loss: 0.5221
Epoch 6/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6294 - RootMeanSquaredError\_1: 0.7070 - loss: 0.4066 -
val\_RootMeanSquaredError: 0.6411 - val\_RootMeanSquaredError\_1: 0.8654 -
val\_loss: 0.4448
Epoch 7/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6199 - RootMeanSquaredError\_1: 0.6960 - loss: 0.3944 -
val\_RootMeanSquaredError: 0.6753 - val\_RootMeanSquaredError\_1: 0.7255 -
val\_loss: 0.4631
Epoch 8/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6132 - RootMeanSquaredError\_1: 0.6871 - loss: 0.3858 -
val\_RootMeanSquaredError: 0.6335 - val\_RootMeanSquaredError\_1: 0.7489 -
val\_loss: 0.4173
Epoch 9/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6076 - RootMeanSquaredError\_1: 0.6790 - loss: 0.3784 -
val\_RootMeanSquaredError: 0.6531 - val\_RootMeanSquaredError\_1: 0.6652 -
val\_loss: 0.4281
Epoch 10/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6028 - RootMeanSquaredError\_1: 0.6717 - loss: 0.3722 -
val\_RootMeanSquaredError: 0.5907 - val\_RootMeanSquaredError\_1: 0.7013 -
val\_loss: 0.3633
Epoch 11/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5979 - RootMeanSquaredError\_1: 0.6642 - loss: 0.3659 -
val\_RootMeanSquaredError: 0.7426 - val\_RootMeanSquaredError\_1: 0.6442 -
val\_loss: 0.5378
Epoch 12/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5944 - RootMeanSquaredError\_1: 0.6580 - loss: 0.3613 -
val\_RootMeanSquaredError: 0.8757 - val\_RootMeanSquaredError\_1: 0.7963 -
val\_loss: 0.7536
Epoch 13/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5914 - RootMeanSquaredError\_1: 0.6521 - loss: 0.3573 -
val\_RootMeanSquaredError: 0.9340 - val\_RootMeanSquaredError\_1: 0.6333 -
val\_loss: 0.8253
Epoch 14/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5879 - RootMeanSquaredError\_1: 0.6464 - loss: 0.3529 -
val\_RootMeanSquaredError: 0.9581 - val\_RootMeanSquaredError\_1: 1.1784 -
val\_loss: 0.9650
Epoch 15/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5856 - RootMeanSquaredError\_1: 0.6434 - loss: 0.3501 -
val\_RootMeanSquaredError: 0.7951 - val\_RootMeanSquaredError\_1: 0.6387 -
val\_loss: 0.6098
Epoch 16/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5814 - RootMeanSquaredError\_1: 0.6365 - loss: 0.3448 -
val\_RootMeanSquaredError: 1.0566 - val\_RootMeanSquaredError\_1: 1.1624 -
val\_loss: 1.1398
Epoch 17/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5800 - RootMeanSquaredError\_1: 0.6342 - loss: 0.3431 -
val\_RootMeanSquaredError: 1.4174 - val\_RootMeanSquaredError\_1: 1.0021 -
val\_loss: 1.9086
Epoch 18/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5801 - RootMeanSquaredError\_1: 0.6311 - loss: 0.3427 -
val\_RootMeanSquaredError: 1.5065 - val\_RootMeanSquaredError\_1: 1.2418 -
val\_loss: 2.1968
Epoch 19/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5793 - RootMeanSquaredError\_1: 0.6276 - loss: 0.3415 -
val\_RootMeanSquaredError: 1.1126 - val\_RootMeanSquaredError\_1: 0.6934 -
val\_loss: 1.1622
Epoch 20/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5742 - RootMeanSquaredError\_1: 0.6232 - loss: 0.3356 -
val\_RootMeanSquaredError: 1.4374 - val\_RootMeanSquaredError\_1: 1.8831 -
val\_loss: 2.2141
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{evalRes} \PY{o}{=} \PY{n}{wideAndDeep}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{p}{(}\PY{n}{XTestWide}\PY{p}{,} \PY{n}{XTestDeep}\PY{p}{)}\PY{p}{,} \PY{n}{ytests}\PY{p}{)}
\PY{c+c1}{\PYZsh{} mainLoss, wSumLoss, mainRmse = evalRes}
\PY{n}{evalRes}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{162/162} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 781us/step -
RootMeanSquaredError: 0.5819 - RootMeanSquaredError\_1: 0.6344 - loss: 0.3451
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
[0.33926549553871155, 0.577087938785553, 0.577087938785553, 0.6287933588027954]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{preds} \PY{o}{=} \PY{n}{regWide}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{p}{(}\PY{n}{XNewDeep}\PY{p}{,} \PY{n}{XNewWide}\PY{p}{)}\PY{p}{)}
\PY{n}{preds} \PY{o}{=} \PY{n+nb}{dict}\PY{p}{(}\PY{n+nb}{zip}\PY{p}{(}\PY{n}{regWide}\PY{o}{.}\PY{n}{output\PYZus{}names}\PY{p}{,} \PY{n}{preds}\PY{p}{)}\PY{p}{)}
\PY{n}{preds}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
WARNING:tensorflow:5 out of the last 318 calls to <function
TensorFlowTrainer.make\_predict\_function.<locals>.one\_step\_on\_data\_distributed at
0x72df9b333a60> triggered tf.function retracing. Tracing is expensive and the
excessive number of tracings could be due to (1) creating @tf.function
repeatedly in a loop, (2) passing tensors with different shapes, (3) passing
Python objects instead of tensors. For (1), please define your @tf.function
outside of the loop. For (2), @tf.function has reduce\_retracing=True option that
can avoid unnecessary retracing. For (3), please refer to
https://www.tensorflow.org/guide/function\#controlling\_retracing and
https://www.tensorflow.org/api\_docs/python/tf/function for  more details.
\textbf{1/1} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 64ms/step
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\{'output': array([[0.47618163],
        [0.71396697],
        [3.7181835 ]], dtype=float32),
 'aux': array([[0.4587401],
        [0.685268 ],
        [3.588437 ]], dtype=float32)\}
\end{Verbatim}
\end{tcolorbox}
        
\subsection{Saving and Restoring a
Model}\label{saving-and-restoring-a-model}

When using the \texttt{Sequential} or \texttt{Functional} APIs you can
save the model by calling the \texttt{save()} method. This will save the
architecture, the model's parameters and the optimizer's parameters. You
can also save the model's weights and optimizer's parameters separately
by calling the \texttt{save\_weights()} method. Calling the
\texttt{export()} method on a function saves it as a TensorFlow
\texttt{SavedModel}, which also saves the function's computation graph.

When using the \texttt{Subclassing} API you can only save the model's
weights and optimizer's parameters by calling the
\texttt{save\_weights()} method.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{pathlib}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{Path}

\PY{n}{modelPath} \PY{o}{=} \PY{n}{Path}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{./models}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{modelPath}\PY{o}{.}\PY{n}{mkdir}\PY{p}{(}\PY{n}{exist\PYZus{}ok}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

\PY{n}{clsName} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{FashionMNIST}\PY{l+s+s2}{\PYZdq{}}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{save}\PY{p}{(}\PY{n}{modelPath} \PY{o}{/} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}}\PY{n}{clsName}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{.keras}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb+bp}{cls}\PY{o}{.}\PY{n}{export}\PY{p}{(}\PY{n}{modelPath} \PY{o}{/} \PY{n}{clsName}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
INFO:tensorflow:Assets written to: models/FashionMNIST/assets
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
INFO:tensorflow:Assets written to: models/FashionMNIST/assets
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Saved artifact at 'models/FashionMNIST'. The following endpoints are available:

* Endpoint 'serve'
  args\_0 (POSITIONAL\_ONLY): TensorSpec(shape=(None, 28, 28), dtype=tf.float32,
name='keras\_tensor\_11')
Output Type:
  TensorSpec(shape=(None, 10), dtype=tf.float32, name=None)
Captures:
  126304782520720: TensorSpec(shape=(), dtype=tf.resource, name=None)
  126304782522832: TensorSpec(shape=(), dtype=tf.resource, name=None)
  126304782522448: TensorSpec(shape=(), dtype=tf.resource, name=None)
  126304782522256: TensorSpec(shape=(), dtype=tf.resource, name=None)
  126304782523024: TensorSpec(shape=(), dtype=tf.resource, name=None)
  126304782523600: TensorSpec(shape=(), dtype=tf.resource, name=None)
    \end{Verbatim}

To load the model you can use the \texttt{load\_model()} function, which
will return a model identical to the one saved. If you only saved the
model's weights you will need to create the model and then call the
\texttt{load\_weights()} method.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fashionCls} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{models}\PY{o}{.}\PY{n}{load\PYZus{}model}\PY{p}{(}\PY{n}{modelPath} \PY{o}{/} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}}\PY{n}{clsName}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{.keras}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{fmnist} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{datasets}\PY{o}{.}\PY{n}{fashion\PYZus{}mnist}\PY{o}{.}\PY{n}{load\PYZus{}data}\PY{p}{(}\PY{p}{)}
\PY{p}{(}\PY{n}{XTrainFull}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{n}{XTest}\PY{p}{,} \PY{n}{yTest}\PY{p}{)} \PY{o}{=} \PY{n}{fmnist}

\PY{n}{XTest} \PY{o}{=} \PY{n}{XTest} \PY{o}{/} \PY{l+m+mf}{255.0}

\PY{n}{preds} \PY{o}{=} \PY{n}{fashionCls}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{XTest}\PY{p}{)}
\PY{n}{preds} \PY{o}{=} \PY{n}{preds}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{classStats}\PY{p}{(}\PY{n}{yTest}\PY{p}{,} \PY{n}{preds}\PY{p}{,} \PY{n}{classNames}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
WARNING:tensorflow:6 out of the last 319 calls to <function
TensorFlowTrainer.make\_predict\_function.<locals>.one\_step\_on\_data\_distributed at
0x72df9f97cb80> triggered tf.function retracing. Tracing is expensive and the
excessive number of tracings could be due to (1) creating @tf.function
repeatedly in a loop, (2) passing tensors with different shapes, (3) passing
Python objects instead of tensors. For (1), please define your @tf.function
outside of the loop. For (2), @tf.function has reduce\_retracing=True option that
can avoid unnecessary retracing. For (3), please refer to
https://www.tensorflow.org/guide/function\#controlling\_retracing and
https://www.tensorflow.org/api\_docs/python/tf/function for  more details.
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
WARNING:tensorflow:6 out of the last 319 calls to <function
TensorFlowTrainer.make\_predict\_function.<locals>.one\_step\_on\_data\_distributed at
0x72df9f97cb80> triggered tf.function retracing. Tracing is expensive and the
excessive number of tracings could be due to (1) creating @tf.function
repeatedly in a loop, (2) passing tensors with different shapes, (3) passing
Python objects instead of tensors. For (1), please define your @tf.function
outside of the loop. For (2), @tf.function has reduce\_retracing=True option that
can avoid unnecessary retracing. For (3), please refer to
https://www.tensorflow.org/guide/function\#controlling\_retracing and
https://www.tensorflow.org/api\_docs/python/tf/function for  more details.
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{313/313} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 991us/step
              precision    recall  f1-score   support

           0       0.84      0.81      0.83      1000
           1       0.99      0.96      0.98      1000
           2       0.76      0.84      0.79      1000
           3       0.81      0.92      0.86      1000
           4       0.79      0.82      0.80      1000
           5       0.88      0.98      0.93      1000
           6       0.79      0.57      0.66      1000
           7       0.95      0.89      0.92      1000
           8       0.94      0.97      0.96      1000
           9       0.97      0.94      0.95      1000

    accuracy                           0.87     10000
   macro avg       0.87      0.87      0.87     10000
weighted avg       0.87      0.87      0.87     10000

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Neural Networks_files/Neural Networks_64_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{pbFashion} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{TFSMLayer}\PY{p}{(}
    \PY{n}{modelPath} \PY{o}{/} \PY{n}{clsName}\PY{p}{,} \PY{n}{call\PYZus{}endpoint}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{serving\PYZus{}default}\PY{l+s+s2}{\PYZdq{}}
\PY{p}{)}

\PY{n}{preds} \PY{o}{=} \PY{n}{pbFashion}\PY{p}{(}\PY{n}{XTest}\PY{p}{)}
\PY{n}{preds} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{preds}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{output\PYZus{}0}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}

\PY{n}{classStats}\PY{p}{(}\PY{n}{yTest}\PY{p}{,} \PY{n}{preds}\PY{p}{,} \PY{n}{classNames}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
              precision    recall  f1-score   support

           0       0.84      0.81      0.83      1000
           1       0.99      0.96      0.98      1000
           2       0.76      0.84      0.79      1000
           3       0.81      0.92      0.86      1000
           4       0.79      0.82      0.80      1000
           5       0.88      0.98      0.93      1000
           6       0.79      0.57      0.66      1000
           7       0.95      0.89      0.92      1000
           8       0.94      0.97      0.96      1000
           9       0.97      0.94      0.95      1000

    accuracy                           0.87     10000
   macro avg       0.87      0.87      0.87     10000
weighted avg       0.87      0.87      0.87     10000

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Neural Networks_files/Neural Networks_65_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
You can also save and load weights using the \texttt{save\_weights()}
and \texttt{load\_weights()} methods. This uses less disk space and is
faster than saving the whole model, but you will need to save the
model's architecture separately.

\subsection{Using Callbacks}\label{using-callbacks}

The \texttt{fit()} method accepts a \texttt{callbacks} argument that
lets you specify a list of objects that Keras will call at the start and
end of training, at the start and end of each epoch, and even before and
after processing each batch. For example the \texttt{ModelCheckpoint}
callback saves checkpoints of your model at regular intervals during
training, by default at the end of each epoch. You can also specify the
\texttt{save\_best\_only=True} argument, which will only save your model
when its performance on the validation set is the best so far. Another
useful callback is the \texttt{EarlyStopping} callback, which interrupts
training when it measures no progress on the validation set for a number
of epochs, specified by the \texttt{patience} argument. This can be used
in combination with the \texttt{ModelCheckpoint} callback to save the
best model when training is interrupted.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{checkpoint} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{callbacks}\PY{o}{.}\PY{n}{ModelCheckpoint}\PY{p}{(}
    \PY{n}{modelPath} \PY{o}{/} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{wideAndDeep\PYZus{}checkpoints.weights.h5}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{save\PYZus{}weights\PYZus{}only}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{n}{save\PYZus{}best\PYZus{}only}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
\PY{p}{)}

\PY{n}{earlyStop} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{callbacks}\PY{o}{.}\PY{n}{EarlyStopping}\PY{p}{(}\PY{n}{patience}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{restore\PYZus{}best\PYZus{}weights}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

\PY{n}{hist} \PY{o}{=} \PY{n}{wideAndDeep}\PY{o}{.}\PY{n}{fit}\PY{p}{(}
    \PY{p}{(}\PY{n}{XTrainWide}\PY{p}{,} \PY{n}{XTrainDeep}\PY{p}{)}\PY{p}{,}
    \PY{n}{ytrains}\PY{p}{,}
    \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,}
    \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{p}{(}\PY{n}{XValidWide}\PY{p}{,} \PY{n}{XValidDeep}\PY{p}{)}\PY{p}{,} \PY{n}{yvals}\PY{p}{)}\PY{p}{,}
    \PY{n}{callbacks}\PY{o}{=}\PY{p}{[}\PY{n}{checkpoint}\PY{p}{,} \PY{n}{earlyStop}\PY{p}{]}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{1s} 1ms/step -
RootMeanSquaredError: 0.5747 - RootMeanSquaredError\_1: 0.6264 - loss: 0.3366 -
val\_RootMeanSquaredError: 1.4027 - val\_RootMeanSquaredError\_1: 1.1160 -
val\_loss: 1.8953
Epoch 2/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5740 - RootMeanSquaredError\_1: 0.6212 - loss: 0.3352 -
val\_RootMeanSquaredError: 1.1059 - val\_RootMeanSquaredError\_1: 1.2985 -
val\_loss: 1.2692
Epoch 3/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5696 - RootMeanSquaredError\_1: 0.6184 - loss: 0.3303 -
val\_RootMeanSquaredError: 0.8283 - val\_RootMeanSquaredError\_1: 0.6903 -
val\_loss: 0.6651
Epoch 4/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5668 - RootMeanSquaredError\_1: 0.6135 - loss: 0.3268 -
val\_RootMeanSquaredError: 1.1103 - val\_RootMeanSquaredError\_1: 1.2245 -
val\_loss: 1.2595
Epoch 5/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5663 - RootMeanSquaredError\_1: 0.6134 - loss: 0.3263 -
val\_RootMeanSquaredError: 1.1915 - val\_RootMeanSquaredError\_1: 0.9500 -
val\_loss: 1.3680
Epoch 6/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5672 - RootMeanSquaredError\_1: 0.6127 - loss: 0.3271 -
val\_RootMeanSquaredError: 1.1928 - val\_RootMeanSquaredError\_1: 1.7316 -
val\_loss: 1.5802
Epoch 7/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5652 - RootMeanSquaredError\_1: 0.6150 - loss: 0.3254 -
val\_RootMeanSquaredError: 1.0477 - val\_RootMeanSquaredError\_1: 0.9157 -
val\_loss: 1.0717
Epoch 8/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5640 - RootMeanSquaredError\_1: 0.6093 - loss: 0.3234 -
val\_RootMeanSquaredError: 0.9953 - val\_RootMeanSquaredError\_1: 1.2899 -
val\_loss: 1.0580
Epoch 9/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5618 - RootMeanSquaredError\_1: 0.6086 - loss: 0.3211 -
val\_RootMeanSquaredError: 0.8066 - val\_RootMeanSquaredError\_1: 0.7483 -
val\_loss: 0.6415
Epoch 10/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5605 - RootMeanSquaredError\_1: 0.6058 - loss: 0.3195 -
val\_RootMeanSquaredError: 1.0338 - val\_RootMeanSquaredError\_1: 1.1420 -
val\_loss: 1.0923
Epoch 11/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5602 - RootMeanSquaredError\_1: 0.6051 - loss: 0.3191 -
val\_RootMeanSquaredError: 1.0583 - val\_RootMeanSquaredError\_1: 0.9010 -
val\_loss: 1.0893
Epoch 12/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5602 - RootMeanSquaredError\_1: 0.6042 - loss: 0.3190 -
val\_RootMeanSquaredError: 1.0585 - val\_RootMeanSquaredError\_1: 1.5290 -
val\_loss: 1.2422
Epoch 13/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5583 - RootMeanSquaredError\_1: 0.6050 - loss: 0.3172 -
val\_RootMeanSquaredError: 0.8286 - val\_RootMeanSquaredError\_1: 0.8183 -
val\_loss: 0.6848
Epoch 14/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5570 - RootMeanSquaredError\_1: 0.6013 - loss: 0.3154 -
val\_RootMeanSquaredError: 1.0213 - val\_RootMeanSquaredError\_1: 1.2052 -
val\_loss: 1.0840
Epoch 15/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5569 - RootMeanSquaredError\_1: 0.6009 - loss: 0.3153 -
val\_RootMeanSquaredError: 0.8784 - val\_RootMeanSquaredError\_1: 0.7932 -
val\_loss: 0.7573
Epoch 16/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5558 - RootMeanSquaredError\_1: 0.5988 - loss: 0.3139 -
val\_RootMeanSquaredError: 1.1506 - val\_RootMeanSquaredError\_1: 1.1822 -
val\_loss: 1.3312
Epoch 17/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5559 - RootMeanSquaredError\_1: 0.5979 - loss: 0.3139 -
val\_RootMeanSquaredError: 1.0621 - val\_RootMeanSquaredError\_1: 0.8752 -
val\_loss: 1.0919
Epoch 18/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5556 - RootMeanSquaredError\_1: 0.5972 - loss: 0.3135 -
val\_RootMeanSquaredError: 0.9998 - val\_RootMeanSquaredError\_1: 1.1077 -
val\_loss: 1.0223
Epoch 19/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5537 - RootMeanSquaredError\_1: 0.5960 - loss: 0.3115 -
val\_RootMeanSquaredError: 0.7957 - val\_RootMeanSquaredError\_1: 0.6926 -
val\_loss: 0.6177
Epoch 20/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5523 - RootMeanSquaredError\_1: 0.5938 - loss: 0.3098 -
val\_RootMeanSquaredError: 0.8167 - val\_RootMeanSquaredError\_1: 0.9693 -
val\_loss: 0.6943
Epoch 21/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5511 - RootMeanSquaredError\_1: 0.5930 - loss: 0.3085 -
val\_RootMeanSquaredError: 0.7157 - val\_RootMeanSquaredError\_1: 0.6734 -
val\_loss: 0.5064
Epoch 22/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5507 - RootMeanSquaredError\_1: 0.5922 - loss: 0.3081 -
val\_RootMeanSquaredError: 0.9484 - val\_RootMeanSquaredError\_1: 0.9995 -
val\_loss: 0.9095
Epoch 23/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5507 - RootMeanSquaredError\_1: 0.5916 - loss: 0.3079 -
val\_RootMeanSquaredError: 0.9413 - val\_RootMeanSquaredError\_1: 0.7843 -
val\_loss: 0.8590
Epoch 24/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5508 - RootMeanSquaredError\_1: 0.5910 - loss: 0.3080 -
val\_RootMeanSquaredError: 0.9960 - val\_RootMeanSquaredError\_1: 1.3859 -
val\_loss: 1.0848
Epoch 25/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5501 - RootMeanSquaredError\_1: 0.5923 - loss: 0.3075 -
val\_RootMeanSquaredError: 0.8405 - val\_RootMeanSquaredError\_1: 0.8404 -
val\_loss: 0.7064
Epoch 26/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5493 - RootMeanSquaredError\_1: 0.5898 - loss: 0.3064 -
val\_RootMeanSquaredError: 0.8693 - val\_RootMeanSquaredError\_1: 1.0139 -
val\_loss: 0.7829
Epoch 27/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5479 - RootMeanSquaredError\_1: 0.5877 - loss: 0.3048 -
val\_RootMeanSquaredError: 0.6776 - val\_RootMeanSquaredError\_1: 0.6298 -
val\_loss: 0.4529
Epoch 28/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5471 - RootMeanSquaredError\_1: 0.5865 - loss: 0.3038 -
val\_RootMeanSquaredError: 0.8521 - val\_RootMeanSquaredError\_1: 0.9563 -
val\_loss: 0.7450
Epoch 29/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5479 - RootMeanSquaredError\_1: 0.5878 - loss: 0.3048 -
val\_RootMeanSquaredError: 0.8346 - val\_RootMeanSquaredError\_1: 0.7558 -
val\_loss: 0.6841
Epoch 30/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5471 - RootMeanSquaredError\_1: 0.5859 - loss: 0.3038 -
val\_RootMeanSquaredError: 0.9366 - val\_RootMeanSquaredError\_1: 1.2434 -
val\_loss: 0.9441
Epoch 31/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5448 - RootMeanSquaredError\_1: 0.5840 - loss: 0.3013 -
val\_RootMeanSquaredError: 0.8158 - val\_RootMeanSquaredError\_1: 0.8978 -
val\_loss: 0.6796
Epoch 32/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5447 - RootMeanSquaredError\_1: 0.5843 - loss: 0.3012 -
val\_RootMeanSquaredError: 0.8045 - val\_RootMeanSquaredError\_1: 0.7176 -
val\_loss: 0.6339
Epoch 33/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5438 - RootMeanSquaredError\_1: 0.5815 - loss: 0.3000 -
val\_RootMeanSquaredError: 0.7032 - val\_RootMeanSquaredError\_1: 0.6171 -
val\_loss: 0.4832
Epoch 34/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5430 - RootMeanSquaredError\_1: 0.5816 - loss: 0.2993 -
val\_RootMeanSquaredError: 0.8456 - val\_RootMeanSquaredError\_1: 0.9718 -
val\_loss: 0.7380
Epoch 35/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5425 - RootMeanSquaredError\_1: 0.5814 - loss: 0.2987 -
val\_RootMeanSquaredError: 0.8133 - val\_RootMeanSquaredError\_1: 0.7557 -
val\_loss: 0.6525
Epoch 36/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5425 - RootMeanSquaredError\_1: 0.5816 - loss: 0.2988 -
val\_RootMeanSquaredError: 0.6379 - val\_RootMeanSquaredError\_1: 0.7324 -
val\_loss: 0.4199
Epoch 37/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5411 - RootMeanSquaredError\_1: 0.5796 - loss: 0.2971 -
val\_RootMeanSquaredError: 0.6410 - val\_RootMeanSquaredError\_1: 0.5897 -
val\_loss: 0.4046
Epoch 38/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5406 - RootMeanSquaredError\_1: 0.5794 - loss: 0.2967 -
val\_RootMeanSquaredError: 0.6772 - val\_RootMeanSquaredError\_1: 0.8651 -
val\_loss: 0.4876
Epoch 39/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5398 - RootMeanSquaredError\_1: 0.5786 - loss: 0.2957 -
val\_RootMeanSquaredError: 0.6132 - val\_RootMeanSquaredError\_1: 0.5858 -
val\_loss: 0.3727
Epoch 40/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5395 - RootMeanSquaredError\_1: 0.5785 - loss: 0.2955 -
val\_RootMeanSquaredError: 0.9271 - val\_RootMeanSquaredError\_1: 1.3718 -
val\_loss: 0.9618
Epoch 41/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5394 - RootMeanSquaredError\_1: 0.5798 - loss: 0.2956 -
val\_RootMeanSquaredError: 0.7829 - val\_RootMeanSquaredError\_1: 0.8517 -
val\_loss: 0.6242
Epoch 42/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5398 - RootMeanSquaredError\_1: 0.5795 - loss: 0.2958 -
val\_RootMeanSquaredError: 1.6921 - val\_RootMeanSquaredError\_1: 1.9738 -
val\_loss: 2.9666
Epoch 43/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5454 - RootMeanSquaredError\_1: 0.5854 - loss: 0.3021 -
val\_RootMeanSquaredError: 0.8399 - val\_RootMeanSquaredError\_1: 0.7203 -
val\_loss: 0.6867
Epoch 44/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5402 - RootMeanSquaredError\_1: 0.5783 - loss: 0.2961 -
val\_RootMeanSquaredError: 0.6235 - val\_RootMeanSquaredError\_1: 0.7759 -
val\_loss: 0.4100
Epoch 45/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5377 - RootMeanSquaredError\_1: 0.5763 - loss: 0.2935 -
val\_RootMeanSquaredError: 0.5308 - val\_RootMeanSquaredError\_1: 0.5859 -
val\_loss: 0.2879
Epoch 46/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5387 - RootMeanSquaredError\_1: 0.5782 - loss: 0.2946 -
val\_RootMeanSquaredError: 0.5518 - val\_RootMeanSquaredError\_1: 0.6495 -
val\_loss: 0.3162
Epoch 47/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5365 - RootMeanSquaredError\_1: 0.5752 - loss: 0.2922 -
val\_RootMeanSquaredError: 0.5273 - val\_RootMeanSquaredError\_1: 0.5826 -
val\_loss: 0.2842
Epoch 48/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5355 - RootMeanSquaredError\_1: 0.5739 - loss: 0.2911 -
val\_RootMeanSquaredError: 0.5395 - val\_RootMeanSquaredError\_1: 0.6340 -
val\_loss: 0.3021
Epoch 49/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5342 - RootMeanSquaredError\_1: 0.5731 - loss: 0.2897 -
val\_RootMeanSquaredError: 0.5349 - val\_RootMeanSquaredError\_1: 0.6087 -
val\_loss: 0.2945
Epoch 50/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5339 - RootMeanSquaredError\_1: 0.5728 - loss: 0.2894 -
val\_RootMeanSquaredError: 0.7951 - val\_RootMeanSquaredError\_1: 0.9697 -
val\_loss: 0.6630
Epoch 51/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5341 - RootMeanSquaredError\_1: 0.5732 - loss: 0.2896 -
val\_RootMeanSquaredError: 0.8907 - val\_RootMeanSquaredError\_1: 0.9911 -
val\_loss: 0.8122
Epoch 52/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5348 - RootMeanSquaredError\_1: 0.5740 - loss: 0.2904 -
val\_RootMeanSquaredError: 0.8140 - val\_RootMeanSquaredError\_1: 0.8948 -
val\_loss: 0.6764
Epoch 53/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5341 - RootMeanSquaredError\_1: 0.5728 - loss: 0.2896 -
val\_RootMeanSquaredError: 0.8266 - val\_RootMeanSquaredError\_1: 0.6926 -
val\_loss: 0.6629
Epoch 54/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5347 - RootMeanSquaredError\_1: 0.5731 - loss: 0.2902 -
val\_RootMeanSquaredError: 0.8771 - val\_RootMeanSquaredError\_1: 0.9348 -
val\_loss: 0.7798
Epoch 55/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5337 - RootMeanSquaredError\_1: 0.5721 - loss: 0.2891 -
val\_RootMeanSquaredError: 0.6440 - val\_RootMeanSquaredError\_1: 0.6874 -
val\_loss: 0.4205
Epoch 56/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5320 - RootMeanSquaredError\_1: 0.5709 - loss: 0.2874 -
val\_RootMeanSquaredError: 0.8745 - val\_RootMeanSquaredError\_1: 0.9783 -
val\_loss: 0.7840
Epoch 57/100
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5320 - RootMeanSquaredError\_1: 0.5706 - loss: 0.2873 -
val\_RootMeanSquaredError: 0.5890 - val\_RootMeanSquaredError\_1: 0.6695 -
val\_loss: 0.3570
    \end{Verbatim}

Custom callbacks can also be written by inheriting from
\texttt{tf.keras.callbacks.Callback} for example the below callback
prints the ratio between the validation loss and the training loss to
detect overfitting

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{class}\PY{+w}{ }\PY{n+nc}{PrintValTrainRatioCallback}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{callbacks}\PY{o}{.}\PY{n}{Callback}\PY{p}{)}\PY{p}{:}
    \PY{k}{def}\PY{+w}{ }\PY{n+nf}{on\PYZus{}epoch\PYZus{}end}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{epoch}\PY{p}{,} \PY{n}{logs}\PY{p}{)}\PY{p}{:}
        \PY{n}{ratio} \PY{o}{=} \PY{n}{logs}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{val\PYZus{}loss}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{/} \PY{n}{logs}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{loss}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Epoch=}\PY{l+s+si}{\PYZob{}}\PY{n}{epoch}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, ratio=}\PY{l+s+si}{\PYZob{}}\PY{n}{ratio}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{hist} \PY{o}{=} \PY{n}{wideAndDeep}\PY{o}{.}\PY{n}{fit}\PY{p}{(}
    \PY{p}{(}\PY{n}{XTrainWide}\PY{p}{,} \PY{n}{XTrainDeep}\PY{p}{)}\PY{p}{,}
    \PY{n}{ytrains}\PY{p}{,}
    \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,}
    \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{p}{(}\PY{n}{XValidWide}\PY{p}{,} \PY{n}{XValidDeep}\PY{p}{)}\PY{p}{,} \PY{n}{yvals}\PY{p}{)}\PY{p}{,}
    \PY{n}{callbacks}\PY{o}{=}\PY{p}{[}\PY{n}{checkpoint}\PY{p}{,} \PY{n}{earlyStop}\PY{p}{,} \PY{n}{PrintValTrainRatioCallback}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/100
\textbf{362/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━} \textbf{0s} 835us/step -
RootMeanSquaredError: 0.5355 - RootMeanSquaredError\_1: 0.5743 - loss: 0.2911
Epoch=0, ratio=1.01
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5355 - RootMeanSquaredError\_1: 0.5743 - loss: 0.2911 -
val\_RootMeanSquaredError: 0.5353 - val\_RootMeanSquaredError\_1: 0.6181 -
val\_loss: 0.2961
Epoch 2/100
\textbf{319/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━━━} \textbf{0s} 956us/step -
RootMeanSquaredError: 0.5350 - RootMeanSquaredError\_1: 0.5733 - loss: 0.2905
Epoch=1, ratio=1.00
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5348 - RootMeanSquaredError\_1: 0.5737 - loss: 0.2903 -
val\_RootMeanSquaredError: 0.5352 - val\_RootMeanSquaredError\_1: 0.5826 -
val\_loss: 0.2917
Epoch 3/100
\textbf{348/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━} \textbf{0s} 871us/step -
RootMeanSquaredError: 0.5347 - RootMeanSquaredError\_1: 0.5735 - loss: 0.2902
Epoch=2, ratio=4.02
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5347 - RootMeanSquaredError\_1: 0.5736 - loss: 0.2902 -
val\_RootMeanSquaredError: 1.0613 - val\_RootMeanSquaredError\_1: 1.2585 -
val\_loss: 1.1721
Epoch 4/100
\textbf{305/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━━━━} \textbf{0s} 828us/step -
RootMeanSquaredError: 0.5361 - RootMeanSquaredError\_1: 0.5748 - loss: 0.2917
Epoch=3, ratio=2.95
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5363 - RootMeanSquaredError\_1: 0.5759 - loss: 0.2921 -
val\_RootMeanSquaredError: 0.9299 - val\_RootMeanSquaredError\_1: 0.9716 -
val\_loss: 0.8726
Epoch 5/100
\textbf{357/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━} \textbf{0s} 849us/step -
RootMeanSquaredError: 0.5358 - RootMeanSquaredError\_1: 0.5751 - loss: 0.2915
Epoch=4, ratio=2.08
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5358 - RootMeanSquaredError\_1: 0.5752 - loss: 0.2915 -
val\_RootMeanSquaredError: 0.7694 - val\_RootMeanSquaredError\_1: 0.8887 -
val\_loss: 0.6118
Epoch 6/100
\textbf{315/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━━━} \textbf{0s} 805us/step -
RootMeanSquaredError: 0.5345 - RootMeanSquaredError\_1: 0.5726 - loss: 0.2900
Epoch=5, ratio=2.36
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5344 - RootMeanSquaredError\_1: 0.5732 - loss: 0.2900 -
val\_RootMeanSquaredError: 0.8325 - val\_RootMeanSquaredError\_1: 0.7989 -
val\_loss: 0.6876
Epoch 7/100
\textbf{308/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━━━━} \textbf{0s} 818us/step -
RootMeanSquaredError: 0.5340 - RootMeanSquaredError\_1: 0.5722 - loss: 0.2894
Epoch=6, ratio=1.41
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5340 - RootMeanSquaredError\_1: 0.5729 - loss: 0.2895 -
val\_RootMeanSquaredError: 0.6307 - val\_RootMeanSquaredError\_1: 0.7347 -
val\_loss: 0.4120
Epoch 8/100
\textbf{316/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━━━} \textbf{0s} 797us/step -
RootMeanSquaredError: 0.5330 - RootMeanSquaredError\_1: 0.5708 - loss: 0.2883
Epoch=7, ratio=1.33
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5328 - RootMeanSquaredError\_1: 0.5712 - loss: 0.2881 -
val\_RootMeanSquaredError: 0.6210 - val\_RootMeanSquaredError\_1: 0.6084 -
val\_loss: 0.3841
Epoch 9/100
\textbf{313/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━━━} \textbf{0s} 806us/step -
RootMeanSquaredError: 0.5321 - RootMeanSquaredError\_1: 0.5700 - loss: 0.2874
Epoch=8, ratio=1.92
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5320 - RootMeanSquaredError\_1: 0.5705 - loss: 0.2873 -
val\_RootMeanSquaredError: 0.7303 - val\_RootMeanSquaredError\_1: 0.8686 -
val\_loss: 0.5555
Epoch 10/100
\textbf{319/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━━━} \textbf{0s} 796us/step -
RootMeanSquaredError: 0.5316 - RootMeanSquaredError\_1: 0.5692 - loss: 0.2868
Epoch=9, ratio=1.00
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5315 - RootMeanSquaredError\_1: 0.5697 - loss: 0.2867 -
val\_RootMeanSquaredError: 0.5310 - val\_RootMeanSquaredError\_1: 0.5793 -
val\_loss: 0.2873
    \end{Verbatim}

\subsection{Using TensorBoard for
Visualization}\label{using-tensorboard-for-visualization}

TensorBoard is a browser-based application that allows you to visualize
training stats. To use it you need to modify your program to output the
data you want to visualize to special binary log files called
\emph{event files}. Each binary data record is called a \emph{summary}.
TensorBoard reads these files and displays the data.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{time}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{strftime}


\PY{k}{def}\PY{+w}{ }\PY{n+nf}{get\PYZus{}run\PYZus{}logdir}\PY{p}{(}\PY{n}{root\PYZus{}logdir}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{logs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{n}{Path}\PY{p}{(}\PY{n}{root\PYZus{}logdir}\PY{p}{)} \PY{o}{/} \PY{n}{strftime}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{run\PYZus{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{Y\PYZus{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{m\PYZus{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s2}{\PYZhy{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{H\PYZus{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{M\PYZus{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{S}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}


\PY{n}{run} \PY{o}{=} \PY{n}{get\PYZus{}run\PYZus{}logdir}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{norm} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Normalization}\PY{p}{(}\PY{p}{)}

\PY{n}{reg} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Sequential}\PY{p}{(}
    \PY{p}{[}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{n}{XTrain}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{)}\PY{p}{,}
        \PY{n}{norm}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}
    \PY{p}{]}
\PY{p}{)}

\PY{n}{opt} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{Adam}\PY{p}{(}\PY{n}{learning\PYZus{}rate}\PY{o}{=}\PY{l+m+mf}{2e\PYZhy{}3}\PY{p}{)}

\PY{n}{reg}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{n}{loss}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mse}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{optimizer}\PY{o}{=}\PY{n}{opt}\PY{p}{,} \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RootMeanSquaredError}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{tensorboard} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{callbacks}\PY{o}{.}\PY{n}{TensorBoard}\PY{p}{(}\PY{n}{run}\PY{p}{,} \PY{n}{profile\PYZus{}batch}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{200}\PY{p}{)}\PY{p}{)}
\PY{n}{norm}\PY{o}{.}\PY{n}{adapt}\PY{p}{(}\PY{n}{XTrain}\PY{p}{)}
\PY{n}{hist} \PY{o}{=} \PY{n}{reg}\PY{o}{.}\PY{n}{fit}\PY{p}{(}
    \PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain}\PY{p}{,} \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{,} \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{n}{XValid}\PY{p}{,} \PY{n}{yValid}\PY{p}{)}\PY{p}{,} \PY{n}{callbacks}\PY{o}{=}\PY{p}{[}\PY{n}{tensorboard}\PY{p}{]}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/20
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
2024-07-23 12:17:51.013127: I
external/local\_tsl/tsl/profiler/lib/profiler\_session.cc:104] Profiler session
initializing.
2024-07-23 12:17:51.013162: I
external/local\_tsl/tsl/profiler/lib/profiler\_session.cc:119] Profiler session
started.
2024-07-23 12:17:51.013720: I
external/local\_tsl/tsl/profiler/lib/profiler\_session.cc:131] Profiler session
tear down.
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{172/363} \textcolor{ansi-green}{━━━━━━━━━}\textcolor{ansi-white}{━━━━━━━━━━━} \textbf{0s} 2ms/step -
RootMeanSquaredError: 1.1236 - loss: 1.3335
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
2024-07-23 12:17:52.373750: I
external/local\_tsl/tsl/profiler/lib/profiler\_session.cc:104] Profiler session
initializing.
2024-07-23 12:17:52.373790: I
external/local\_tsl/tsl/profiler/lib/profiler\_session.cc:119] Profiler session
started.
2024-07-23 12:17:52.545277: I
external/local\_tsl/tsl/profiler/lib/profiler\_session.cc:70] Profiler session
collecting data.
2024-07-23 12:17:52.574379: I
external/local\_tsl/tsl/profiler/lib/profiler\_session.cc:131] Profiler session
tear down.
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{319/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━}\textcolor{ansi-white}{━━━} \textbf{0s} 2ms/step -
RootMeanSquaredError: 0.9936 - loss: 1.0455
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
2024-07-23 12:17:52.576488: I
external/local\_tsl/tsl/profiler/rpc/client/save\_profile.cc:144] Collecting
XSpace to repository:
logs/run\_2024\_07\_23-12\_17\_50/plugins/profile/2024\_07\_23\_12\_17\_52/BMO-
end.xplane.pb
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{2s} 3ms/step -
RootMeanSquaredError: 0.9689 - loss: 0.9941 - val\_RootMeanSquaredError: 0.8554 -
val\_loss: 0.7317
Epoch 2/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6371 - loss: 0.4061 - val\_RootMeanSquaredError: 0.5914 -
val\_loss: 0.3498
Epoch 3/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.6099 - loss: 0.3722 - val\_RootMeanSquaredError: 0.7210 -
val\_loss: 0.5199
Epoch 4/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5902 - loss: 0.3486 - val\_RootMeanSquaredError: 0.8382 -
val\_loss: 0.7026
Epoch 5/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5776 - loss: 0.3337 - val\_RootMeanSquaredError: 0.7712 -
val\_loss: 0.5948
Epoch 6/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5679 - loss: 0.3227 - val\_RootMeanSquaredError: 0.7254 -
val\_loss: 0.5261
Epoch 7/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5588 - loss: 0.3124 - val\_RootMeanSquaredError: 0.5415 -
val\_loss: 0.2932
Epoch 8/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5496 - loss: 0.3022 - val\_RootMeanSquaredError: 0.5793 -
val\_loss: 0.3356
Epoch 9/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5425 - loss: 0.2943 - val\_RootMeanSquaredError: 0.5851 -
val\_loss: 0.3423
Epoch 10/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5413 - loss: 0.2931 - val\_RootMeanSquaredError: 0.6448 -
val\_loss: 0.4158
Epoch 11/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{1s} 2ms/step -
RootMeanSquaredError: 0.5383 - loss: 0.2898 - val\_RootMeanSquaredError: 0.5335 -
val\_loss: 0.2847
Epoch 12/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{1s} 2ms/step -
RootMeanSquaredError: 0.5339 - loss: 0.2851 - val\_RootMeanSquaredError: 0.5682 -
val\_loss: 0.3228
Epoch 13/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{1s} 1ms/step -
RootMeanSquaredError: 0.5303 - loss: 0.2813 - val\_RootMeanSquaredError: 0.6181 -
val\_loss: 0.3821
Epoch 14/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5291 - loss: 0.2800 - val\_RootMeanSquaredError: 0.6360 -
val\_loss: 0.4045
Epoch 15/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5266 - loss: 0.2774 - val\_RootMeanSquaredError: 0.5525 -
val\_loss: 0.3052
Epoch 16/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{1s} 1ms/step -
RootMeanSquaredError: 0.5225 - loss: 0.2730 - val\_RootMeanSquaredError: 0.7503 -
val\_loss: 0.5630
Epoch 17/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5215 - loss: 0.2720 - val\_RootMeanSquaredError: 0.5498 -
val\_loss: 0.3023
Epoch 18/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5259 - loss: 0.2766 - val\_RootMeanSquaredError: 0.5276 -
val\_loss: 0.2783
Epoch 19/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5194 - loss: 0.2699 - val\_RootMeanSquaredError: 0.5305 -
val\_loss: 0.2814
Epoch 20/20
\textbf{363/363} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{0s} 1ms/step -
RootMeanSquaredError: 0.5172 - loss: 0.2676 - val\_RootMeanSquaredError: 0.5167 -
val\_loss: 0.2669
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{load\PYZus{}ext} tensorboard
\PY{o}{\PYZpc{}}\PY{k}{tensorboard} \PYZhy{}\PYZhy{}logdir=./logs
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
\subsection{Fine-Tuning Neural Network
Hyperparameters}\label{fine-tuning-neural-network-hyperparameters}

One option to determine the best hyperparameters for a neural network,
is to convert it from a Keras model to a Scikit-Learn estimator, and
using \texttt{GridSearchCV} or \texttt{RamdomSearchCV} to fine tune the
hyperparameters. For this you can use the \texttt{KerasRegressor} or
\texttt{KerasClassifier} wrapper classes from SciKeras. But a better way
is to use the \textbf{Keras Tuner} library.

\subsubsection{Using Keras Tuner}\label{using-keras-tuner}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{!}\PY{o}{\PYZob{}}sys.executable\PY{o}{\PYZcb{}}\PY{+w}{ }\PYZhy{}m\PY{+w}{ }pip\PY{+w}{ }install\PY{+w}{ }keras\PYZhy{}tuner
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{keras\PYZus{}tuner}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{kt}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Collecting keras-tuner
  Downloading keras\_tuner-1.4.7-py3-none-any.whl.metadata (5.4 kB)
Requirement already satisfied: keras in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras-tuner)
(3.3.3)
Requirement already satisfied: packaging in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras-tuner)
(24.1)
Requirement already satisfied: requests in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras-tuner)
(2.32.3)
Collecting kt-legacy (from keras-tuner)
  Downloading kt\_legacy-1.0.5-py3-none-any.whl.metadata (221 bytes)
Requirement already satisfied: absl-py in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras->keras-
tuner) (2.1.0)
Requirement already satisfied: numpy in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras->keras-
tuner) (1.26.4)
Requirement already satisfied: rich in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras->keras-
tuner) (13.7.1)
Requirement already satisfied: namex in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras->keras-
tuner) (0.0.8)
Requirement already satisfied: h5py in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras->keras-
tuner) (3.11.0)
Requirement already satisfied: optree in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras->keras-
tuner) (0.11.0)
Requirement already satisfied: ml-dtypes in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from keras->keras-
tuner) (0.3.2)
Requirement already satisfied: charset-normalizer<4,>=2 in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from
requests->keras-tuner) (3.3.2)
Requirement already satisfied: idna<4,>=2.5 in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from
requests->keras-tuner) (3.7)
Requirement already satisfied: urllib3<3,>=1.21.1 in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from
requests->keras-tuner) (2.2.2)
Requirement already satisfied: certifi>=2017.4.17 in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from
requests->keras-tuner) (2024.6.2)
Requirement already satisfied: typing-extensions>=4.0.0 in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from
optree->keras->keras-tuner) (4.12.2)
Requirement already satisfied: markdown-it-py>=2.2.0 in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from
rich->keras->keras-tuner) (3.0.0)
Requirement already satisfied: pygments<3.0.0,>=2.13.0 in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from
rich->keras->keras-tuner) (2.18.0)
Requirement already satisfied: mdurl\textasciitilde{}=0.1 in
/home/mads/.pyenv/versions/ai/lib/python3.12/site-packages (from markdown-it-
py>=2.2.0->rich->keras->keras-tuner) (0.1.2)
Downloading keras\_tuner-1.4.7-py3-none-any.whl (129 kB)
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{114,156,31}}{━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━}
\textcolor{ansi-green}{129.1/129.1 kB} \textcolor{ansi-red}{440.2 kB/s} eta \textcolor{ansi-cyan}{0:00:00} kB/s eta
\textcolor{ansi-cyan}{0:00:01}:01
Downloading kt\_legacy-1.0.5-py3-none-any.whl (9.6 kB)
Installing collected packages: kt-legacy, keras-tuner
Successfully installed keras-tuner-1.4.7 kt-legacy-1.0.5
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{buildModel}\PY{p}{(}\PY{n}{hp}\PY{p}{)}\PY{p}{:}
    \PY{n}{nHidden} \PY{o}{=} \PY{n}{hp}\PY{o}{.}\PY{n}{Int}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{n\PYZus{}hidden}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{min\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{max\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{8}\PY{p}{,} \PY{n}{default}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
    \PY{n}{nNeurons} \PY{o}{=} \PY{n}{hp}\PY{o}{.}\PY{n}{Int}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{n\PYZus{}neurons}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{min\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{,} \PY{n}{max\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{256}\PY{p}{)}
    \PY{n}{learningRate} \PY{o}{=} \PY{n}{hp}\PY{o}{.}\PY{n}{Float}\PY{p}{(}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{learning\PYZus{}rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{min\PYZus{}value}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}4}\PY{p}{,} \PY{n}{max\PYZus{}value}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}2}\PY{p}{,} \PY{n}{sampling}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{log}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}
    \PY{n}{optimizer} \PY{o}{=} \PY{n}{hp}\PY{o}{.}\PY{n}{Choice}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{optimizer}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{values}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sgd}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{adam}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}

    \PY{k}{if} \PY{n}{optimizer} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sdg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:}
        \PY{n}{optimizer} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{SGD}\PY{p}{(}\PY{n}{learning\PYZus{}rate}\PY{o}{=}\PY{n}{learningRate}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{optimizer} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{Adam}\PY{p}{(}\PY{n}{learning\PYZus{}rate}\PY{o}{=}\PY{n}{learningRate}\PY{p}{)}

    \PY{n}{model} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Sequential}\PY{p}{(}\PY{p}{)}
    \PY{n}{model}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Flatten}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{k}{for} \PY{n}{\PYZus{}} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{nHidden}\PY{p}{)}\PY{p}{:}
        \PY{n}{model}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{n}{nNeurons}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
    \PY{n}{model}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{softmax}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
    \PY{n}{model}\PY{o}{.}\PY{n}{compile}\PY{p}{(}
        \PY{n}{loss}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sparse\PYZus{}categorical\PYZus{}crossentropy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{optimizer}\PY{o}{=}\PY{n}{optimizer}\PY{p}{,}
        \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
    \PY{p}{)}
    \PY{k}{return} \PY{n}{model}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}
\end{tcolorbox}

\chapter{Deep Computer Vision and Convolutional Neural Networks
(CNNs)}\label{deep-computer-vision-and-convolutional-neural-networks-cnns}

Convolutional Neural Networks are designed based on the way the human
visual cortex perceives images with the neurons in the visual cortex
being sensitive to small sub-regions of the visual field, called
\emph{receptive fields}. This is the basis of the design of CNNs, where
the neurons in the first layer are connected to the pixels in the images
in their receptive fields, and the neurons in the next layer are
connected to the neurons in the previous layer, and so on

\section{Convolutional Layers}\label{convolutional-layers}

Neurons in the first Convolutional layer are not connected to every
pixel in the input image but instead only to pixels in their receptive
fields. In turn each neuron in the second convolutional layer is
connected only to neurons located within in a small rectangle in the
first layer. This architecture allows the network to concentrate on
low-level features in the first hidden layer, then assemble them into
higher-level features in the next hidden layer, and so on. The layers of
a CNN are arranged in 2 dimensions in rows and in columns unlike the
multi-layered perceptrons which are arranged in a single dimension.

A neuron located in row \(i\), column \(j\) of a given layer is
connected to the outputs of the neurons in the previous layer located in
rows \(i\) to \(i + f_h - 1\), columns \(j\) to \(j + f_w - 1\), where
\(f_h\) and \(f_w\) are the height and width of the receptive field. In
order for a layer to have the same height and weight as the previous
layer it is common to add zeros around the inputs, called \emph{zero
padding}. It is also possible to connect a large input layer to a much
smaller layer by spacing out the receptive fields, thereby greatly
reducing the model's computational complexity.

The horizontal or vertical step size from one receptive field to the
next is called the \emph{stride}. By increasing the stride the output
layer will be smaller than the input layer, but the receptive field will
be larger.

\subsection{Filters}\label{filters}

A neuron's weights can be represented as a small image the size of the
receptive field. These weights can be termed as \emph{filters} /
\emph{convolutional kernels} / \emph{kernels}. These weights can be used
to change what data the neuron actually takes in with entires in the
filter being the parameters that the backpropagation algorithm can
tweak. For example for a neuron with a receptive field of size 7x7, a
filter could be a 7x7 matrix with all entries being 0 except for the 4th
column which would be 1s. This filter would cause the neuron to detect
everything in its receptive field except for the central vertical line,
making it only sensitive to vertical lines.

Now if all the neurons in a layer use this vertical line filter (and the
same bias term) an image passed to this layer would enhance the vertical
lines in the image, while the horizontal lines would be blurred. Thus a
layer full of neuron using the same filter outputs a \textbf{feature
map}, which highlights the areas in an image that activate the filter
the most. During training the convolutional layer learns the most useful
features fo the task at hand, which above layers can then use to detect
more complex patterns.

Employing the filter of a feature map the output of a neuron in a
convolutional layer can be calculated as follows: \[
z_{i, j} = b + \displaystyle\sum_{u=0}^{f_h-1} \displaystyle\sum_{v=0}^{f_w-1} x_{i', j'} \times w_{u, v} \text{ with } \begin{cases}
i' = i \times s_h + u \\
j' = j \times s_w + v
\end{cases}
\]

With:

\begin{itemize}
\item
  \(z_{i,j}\) being the output of the neuron located in row \(i\) and
  column \(j\) in the convolutional layer
\item
  \(b\) being the bias term for the neuron
\item
  \(s_h\) and \(s_w\) being the vertical and horizontal strides
\item
  \(f_h\) and \(f_w\) being the height and width of the receptive field
\item
  \(x_{i', j'}\) being the input of the neuron located in row \(i'\) and
  column \(j'\) in the previous layer
\item
  \(w_{u,v}\) being the connection weight between any neuron in the
  previous layer and the neuron located in row \(u\) and column \(v\) in
  the convolutional layer
\end{itemize}

\subsection{Stacking Feature Maps}\label{stacking-feature-maps}

Convolution layers can have multiple filters and outputs one feature map
per feature. CLs have one on neuron per pixel in each feature map, and
all neurons within a given feature map share the same parameters, kernel
and bias term. Neurons in different feature maps have different
parameters, meaning the previous CL in the network neurons' receptive
fields extend across the depth of the next CL, simultaneously applying
all the filters to its input making it able to detect multiple features
anywhere in its inputs.

Input layers are also composed of layers on per colour channel, usually
coloured pictures have Red, Green and Blue layers. Specifically a neuron
in the \(i\)th row, \(j\)th column and \(k\) feature map of a CL \(l\)
is connected to the output neurons of the \(l-1\) CL in the in the rows
\(i \times s_h\) to \(i \times s_h + f_h - 1\) and columns
\(j \times s_w\) to \(j \times s_w + f_w - 1\), across all feature maps
in later \(l-1\). Note that within a CL, all the neuron in the same row
\(i\) and column \(j\) but in different feature maps are connected to
the outputs of the same neurons in the previous layer. This leads to the
output of a neuron in a feature map having the following equation: \[
z_{i,j,k} = b_k + \displaystyle\sum_{u = 0}^{f_h - 1} \displaystyle\sum_{v = 0}^{f_w - 1} \displaystyle\sum_{k' = 0}^{f_{n'} - 1} x_{i', j', k'} \times w_{u, v, k', k} \text{ with } \begin{cases}
i' = i \times s_h + u \\
j' = j \times s_w + v
\end{cases}
\]

With

\begin{itemize}
\item
  \(z_{i, j, k}\) being the output of the neuron located in row \(i\),
  column \(j\) in feature map \(k\) of the convolutional layer \(l\)
\item
  \(s_h\) and \(s_h\) being the vertical and horizontal stride and
  \(f_w\) and \(f_h\) being the width and height of the receptive field
\item
  \(f_{n'}\) being the number of feature maps in the previous layer
  (\(l - 1\))
\item
  \(x_{i', j', k'}\) being the output if the neuron located in layer
  \(l-1\), row \(i'\), column \(j'\) and feature map \(k'\) or channel
  \(k'\) if the previous layer is the input layer.
\item
  \(b_k\) being the bias term for the feature map \(k\) in layer \(l\),
  which basically determines the brightness of feature map \(k\)
\item
  \(w_{u, v, k', k}\) being the connection weight between any neuron in
  feature map \(k\) of the layer \(l\) and its input located at row
  \(u\), column \(v\), relative to the neuron's receptive field, and
  feature map \(k'\)
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{datasets}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{load\PYZus{}sample\PYZus{}images}

\PY{n}{images} \PY{o}{=} \PY{n}{load\PYZus{}sample\PYZus{}images}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{images}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
\PY{n}{images} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{CenterCrop}\PY{p}{(}\PY{n}{height}\PY{o}{=}\PY{l+m+mi}{70}\PY{p}{,} \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{120}\PY{p}{)}\PY{p}{(}\PY{n}{images}\PY{p}{)}
\PY{n}{images} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Rescaling}\PY{p}{(}\PY{n}{scale}\PY{o}{=}\PY{l+m+mi}{1} \PY{o}{/} \PY{l+m+mi}{255}\PY{p}{)}\PY{p}{(}\PY{n}{images}\PY{p}{)}
\PY{n}{images}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
TensorShape([2, 70, 120, 3])
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{convLayer1} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Conv2D}\PY{p}{(}\PY{n}{filters}\PY{o}{=}\PY{l+m+mi}{32}\PY{p}{,} \PY{n}{kernel\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{7}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{same}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{fmaps} \PY{o}{=} \PY{n}{convLayer1}\PY{p}{(}\PY{n}{images}\PY{p}{)}
\PY{n}{fmaps}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
TensorShape([2, 70, 120, 32])
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{kernels}\PY{p}{,} \PY{n}{biases} \PY{o}{=} \PY{n}{convLayer1}\PY{o}{.}\PY{n}{get\PYZus{}weights}\PY{p}{(}\PY{p}{)}
\PY{n}{kernels}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(7, 7, 3, 32)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{biases}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(32,)
\end{Verbatim}
\end{tcolorbox}
        
\subsection{Activation functions}\label{activation-functions}

As the convolutional layers perform linear operations, and thus can only
learn linear transformations of the input data, it is necessary to
introduce non-linearity to the layers to allow the network to learn
complex patterns. This is done by applying an activation function to the
output of each neuron in the convolutional layer. The most common
activation function used in CNNs is the \textbf{Rectified Linear Unit
(ReLU)}, already defined above. This function is usually applied to the
hidden convolutional layers of the network, but not to the output layer.

Activation functions are applied on the whole layer at once, meaning
that the same activation function is applied to all the neurons in the
layer. This is done to ensure that the network can learn to detect
different patterns in different parts of the image. Therefore the
activation function augments the output of the neuron in the feature map
\(k\) of the layer \(l\) as follows: \[
h_{i, j, k} = \text{ReLU}(z_{i, j, k})
\]

And in the case of a convolutional layer with a single feature map: \[
h_{i, j} = \text{ReLU}(z_{i, j})
\]

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{convLayer1} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Conv2D}\PY{p}{(}
    \PY{n}{filters}\PY{o}{=}\PY{l+m+mi}{32}\PY{p}{,} \PY{n}{kernel\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{7}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{same}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}
\PY{p}{)}
\PY{n}{fmaps} \PY{o}{=} \PY{n}{convLayer1}\PY{p}{(}\PY{n}{images}\PY{p}{)}
\PY{n}{fmaps}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
TensorShape([2, 70, 120, 32])
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{kernels}\PY{p}{,} \PY{n}{biases} \PY{o}{=} \PY{n}{convLayer1}\PY{o}{.}\PY{n}{get\PYZus{}weights}\PY{p}{(}\PY{p}{)}
\PY{n}{kernels}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(7, 7, 3, 32)
\end{Verbatim}
\end{tcolorbox}
        
\section{Pooling Layers}\label{pooling-layers}

The goal of pooling layers is to subsample / shrink the input image in
order to reduce the computational load, memory usage and the number of
parameters. Just like convolutional layers each neuron in a pooling
layer is only connected to a limited number of neurons in the previous
layer in a receptive field, however a pooling layer has no weights, all
it does is aggregate the inputs using an aggregation function such as
the mean or the max. A pooling layer employing the max aggregation
function is called a \textbf{max pooling layer}.

Other than reducing computations, memory usage, and the number of
parameters, max pooling layers introduce some level of
\textbf{\emph{invariance}} to small translations. This means that if a
small feature is slightly moved in the input image, the output of the
max pooling layer may not change. This can be useful for detecting
patterns in images, as the location of the pattern in the image will not
matter. By inserting a max pooling layer after every convolutional
layer, the network can learn to be invariant to small translations which
can be useful for classification tasks.

Max Pooling is however very destructive, as it discards all the
information except for the maximum value. This can be a problem for
tasks that require precise localization. To address this issue, a common
strategy is to add a convolutional layer with the same number of filters
as the max pooling layer just before the max pooling layer. This way the
network can learn to preserve the information that will be most useful
to the max pooling layer.

Pooling can also be performed along the depth dimension instead of
spatial dimensions which will allow the CNN to be invariant to various
features, such as rotation and scaling.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{maxPool} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{MaxPool2D}\PY{p}{(}\PY{n}{pool\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{class}\PY{+w}{ }\PY{n+nc}{DepthPool}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Layer}\PY{p}{)}\PY{p}{:}
    \PY{k}{def}\PY{+w}{ }\PY{n+nf+fm}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{pool\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{o}{*}\PY{o}{*}\PY{n}{kwargs}\PY{p}{)}\PY{p}{:}
        \PY{n+nb}{super}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n+nf+fm}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{o}{*}\PY{o}{*}\PY{n}{kwargs}\PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{pool\PYZus{}size} \PY{o}{=} \PY{n}{pool\PYZus{}size}

    \PY{k}{def}\PY{+w}{ }\PY{n+nf}{call}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{inputs}\PY{p}{)}\PY{p}{:}
        \PY{n}{shape} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{inputs}\PY{p}{)}
        \PY{n}{groups} \PY{o}{=} \PY{n}{shape}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{/}\PY{o}{/} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{pool\PYZus{}size}
        \PY{n}{newShape} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{concat}\PY{p}{(}\PY{p}{[}\PY{n}{shape}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{n}{groups}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{pool\PYZus{}size}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
        \PY{k}{return} \PY{n}{tf}\PY{o}{.}\PY{n}{reduce\PYZus{}max}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{n}{inputs}\PY{p}{,} \PY{n}{newShape}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

Another type of pooling layer used commonly is the \emph{global average
pooling layer}. This layer computes the mean of each entire feature map,
like an average pooling layer using a pooling size of the entire feature
map. This means the layer outputs a single number per feature map and
per instance. Although this is very destructive it can be useful just
before the output layer.

Keras does not have a Depth wise Max Pooling layer, but it can be
implemented reshaping its inputs to split the channels into groups of
the desired, size then using \texttt{tf.reduce\_max()} to compute the
max of each group. This implementation assumes that the stride is equal
to the pooling size.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{globAvgPool} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{GlobalAveragePooling2D}\PY{p}{(}\PY{p}{)}
\PY{n}{globAvgPool}\PY{p}{(}\PY{n}{images}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<tf.Tensor: shape=(2, 3), dtype=float32, numpy=
array([[0.64338624, 0.5971759 , 0.5824972 ],
       [0.76306933, 0.2601113 , 0.10849128]], dtype=float32)>
\end{Verbatim}
\end{tcolorbox}
        
\section{CNN Architectures}\label{cnn-architectures}

A typical CNN architecture consists of a few convolutional layers, each
generally followed by a ReLU layer, then a pooling layer, then another
few convolutional layers again followed by a ReLU, then another pooling
layer, and so on. The image gets smaller and smaller as it goes through
the network, but also getting deeper and deeper due to the increasing
number of filters in each convolutional layer. At the top of the stack
of convolutional layers a regular feedforward neural network is added,
composed of a few fully connected layers (+ReLU), and the final layer
outputs the prediction, potentially using a softmax activation function
if the network is used for classification to output estimated class
probabilities.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{functools}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{partial}

\PY{n}{conv2DLayer} \PY{o}{=} \PY{n}{partial}\PY{p}{(}
    \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Conv2D}\PY{p}{,}
    \PY{n}{kernel\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,}
    \PY{n}{padding}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{same}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{kernel\PYZus{}initializer}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{he\PYZus{}normal}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{p}{)}
\PY{n}{ffLayer} \PY{o}{=} \PY{n}{partial}\PY{p}{(}
    \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{relu}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{kernel\PYZus{}initializer}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{he\PYZus{}normal}\PY{l+s+s2}{\PYZdq{}}
\PY{p}{)}

\PY{n}{cnnCls} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{Sequential}\PY{p}{(}
    \PY{p}{[}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Reshape}\PY{p}{(}\PY{n}{target\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,}
        \PY{n}{conv2DLayer}\PY{p}{(}\PY{n}{filters}\PY{o}{=}\PY{l+m+mi}{64}\PY{p}{,} \PY{n}{kernel\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{7}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{MaxPool2D}\PY{p}{(}\PY{p}{)}\PY{p}{,}
        \PY{n}{conv2DLayer}\PY{p}{(}\PY{n}{filters}\PY{o}{=}\PY{l+m+mi}{128}\PY{p}{)}\PY{p}{,}
        \PY{n}{conv2DLayer}\PY{p}{(}\PY{n}{filters}\PY{o}{=}\PY{l+m+mi}{128}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{MaxPool2D}\PY{p}{(}\PY{p}{)}\PY{p}{,}
        \PY{n}{conv2DLayer}\PY{p}{(}\PY{n}{filters}\PY{o}{=}\PY{l+m+mi}{256}\PY{p}{)}\PY{p}{,}
        \PY{n}{conv2DLayer}\PY{p}{(}\PY{n}{filters}\PY{o}{=}\PY{l+m+mi}{256}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{MaxPool2D}\PY{p}{(}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Flatten}\PY{p}{(}\PY{p}{)}\PY{p}{,}
        \PY{n}{ffLayer}\PY{p}{(}\PY{n}{units}\PY{o}{=}\PY{l+m+mi}{128}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.5}\PY{p}{)}\PY{p}{,}
        \PY{n}{ffLayer}\PY{p}{(}\PY{n}{units}\PY{o}{=}\PY{l+m+mi}{64}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.5}\PY{p}{)}\PY{p}{,}
        \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{layers}\PY{o}{.}\PY{n}{Dense}\PY{p}{(}\PY{n}{units}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{softmax}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{p}{]}
\PY{p}{)}

\PY{n}{cnnCls}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{Model: "sequential\_4"}

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃\textbf{ }\textbf{Layer (type)                   }\textbf{ }┃\textbf{ }\textbf{Output Shape          }\textbf{ }┃\textbf{ }\textbf{      Param \#}\textbf{ }┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ reshape (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Reshape})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{28}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{28}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1})      │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_2 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{28}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{28}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{64})     │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{3,200} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ max\_pooling2d\_1 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{MaxPooling2D})  │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{64})     │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_3 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})    │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{73,856} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_4 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})    │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{147,584} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ max\_pooling2d\_2 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{MaxPooling2D})  │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})      │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_5 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{256})      │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{295,168} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_6 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{256})      │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{590,080} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ max\_pooling2d\_3 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{MaxPooling2D})  │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{3}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{3}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{256})      │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ flatten\_2 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Flatten})             │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{2304})           │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_23 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})            │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{295,040} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dropout})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})            │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_24 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{64})             │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{8,256} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout\_1 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dropout})             │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{64})             │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_25 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{10})             │           \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{650} │
└─────────────────────────────────┴────────────────────────┴───────────────┘

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Total params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,413,834} (5.39 MB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,413,834} (5.39 MB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Non-trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} (0.00 B)

    \end{Verbatim}

    
\begin{itemize}
\item
  First we use the \texttt{partial()} function to defined a template
  Convolutional Layer, with a small kernel size of 3x3, a stride of 1,
  the \texttt{same} padding, and the ReLU activation function. This
  template can be used to create any number of layers in the CNN.
\item
  Next we create the CNN with the first \texttt{Input} layer taking in
  images in array representation of size \(28\times 28\times 1\) as the
  images in the Fashion MNIST dataset are of size \(28\times 28\) and
  are in greyscale, with a \texttt{Reshape} layer to ensure the images
  are of this size.
\item
  The first CL is of size 64 with fairly large filters (\(7\times 7\))
  which creates a 64 feature maps each of size \(28\times 28\).
\item
  Then we add a max pooling layer with a default pool size of 2, so it
  downscales the feature maps by a factor of 2, resulting in 64 feature
  maps of size \(14\times 14\).
\item
  We repeat the same structure twice, two convolutional layers followed
  by a max pooling layer, each adding on more feature maps, deepening
  the network. For larger images this structure could be repeated using
  the number of repetitions hyperparameter. The number of filters double
  as we climb up the CNN toward the output layer (64, 128, 256), as the
  number of low-level features is usually much lower than the number of
  high-level features. It is common to double the number of filters
  after each pooling layer as the pooling layer reduces the size of the
  feature maps by 2 by default, so we can afford to double the number of
  filters in the next layer without increasing the computational load.
\item
  Next is the fully connected network, composed of two dense hidden
  layers and a dense output layer. Since it is a classification task
  with 10 classes the output layer has 10 layers and uses the softmax
  activation function to determine the class probabilities of each
  class. We must flatten the inputs just before the first dense layer as
  it expects a 1D array of features for each instance. Two dropout
  layers with a dropout rate of 50\% each have also been added to reduce
  overfitting.
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{cnnCls}\PY{o}{.}\PY{n}{compile}\PY{p}{(}
    \PY{n}{loss}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sparse\PYZus{}categorical\PYZus{}crossentropy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{optimizer}\PY{o}{=}\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{optimizers}\PY{o}{.}\PY{n}{SGD}\PY{p}{(}\PY{n}{learning\PYZus{}rate}\PY{o}{=}\PY{l+m+mf}{0.09}\PY{p}{)}\PY{p}{,}
    \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
\PY{p}{)}
\PY{n}{cnnCls}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{Model: "sequential\_4"}

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃\textbf{ }\textbf{Layer (type)                   }\textbf{ }┃\textbf{ }\textbf{Output Shape          }\textbf{ }┃\textbf{ }\textbf{      Param \#}\textbf{ }┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ reshape (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Reshape})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{28}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{28}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1})      │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_2 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{28}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{28}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{64})     │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{3,200} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ max\_pooling2d\_1 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{MaxPooling2D})  │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{64})     │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_3 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})    │        \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{73,856} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_4 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{14}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})    │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{147,584} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ max\_pooling2d\_2 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{MaxPooling2D})  │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})      │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_5 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{256})      │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{295,168} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ conv2d\_6 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Conv2D})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{7}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{256})      │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{590,080} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ max\_pooling2d\_3 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{MaxPooling2D})  │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{3}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{3}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{256})      │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ flatten\_2 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Flatten})             │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{2304})           │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_23 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})            │       \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{295,040} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dropout})               │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{128})            │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_24 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{64})             │         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{8,256} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout\_1 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dropout})             │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{64})             │             \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense\_25 (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,135,255}}{Dense})                │ (\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,215,255}}{None}, \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{10})             │           \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{650} │
└─────────────────────────────────┴────────────────────────┴───────────────┘

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Total params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,413,834} (5.39 MB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{1,413,834} (5.39 MB)

    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{ Non-trainable params: }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{0,175,0}}{0} (0.00 B)

    \end{Verbatim}

    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{p}{(}\PY{n}{XTrainFull}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{n}{XTest}\PY{p}{,} \PY{n}{yTest}\PY{p}{)} \PY{o}{=} \PY{n}{fmnist}

\PY{n}{cutoff} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{5000}
\PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain} \PY{o}{=} \PY{n}{XTrainFull}\PY{p}{[}\PY{p}{:}\PY{n}{cutoff}\PY{p}{]}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{[}\PY{p}{:}\PY{n}{cutoff}\PY{p}{]}
\PY{n}{XValid}\PY{p}{,} \PY{n}{yValid} \PY{o}{=} \PY{n}{XTrainFull}\PY{p}{[}\PY{n}{cutoff}\PY{p}{:}\PY{p}{]}\PY{p}{,} \PY{n}{yTrainFull}\PY{p}{[}\PY{n}{cutoff}\PY{p}{:}\PY{p}{]}
\PY{n}{XTrain}\PY{p}{,} \PY{n}{XValid}\PY{p}{,} \PY{n}{XTest} \PY{o}{=} \PY{n}{XTrain} \PY{o}{/} \PY{l+m+mf}{255.0}\PY{p}{,} \PY{n}{XValid} \PY{o}{/} \PY{l+m+mf}{255.0}\PY{p}{,} \PY{n}{XTest} \PY{o}{/} \PY{l+m+mf}{255.0}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{hist} \PY{o}{=} \PY{n}{cnnCls}\PY{o}{.}\PY{n}{fit}\PY{p}{(}
    \PY{n}{XTrain}\PY{p}{,} \PY{n}{yTrain}\PY{p}{,} \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{n}{XValid}\PY{p}{,} \PY{n}{yValid}\PY{p}{)}\PY{p}{,} \PY{n}{callbacks}\PY{o}{=}\PY{p}{[}\PY{n}{earlyStop}\PY{p}{]}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{139s} 80ms/step
- accuracy: 0.5495 - loss: 1.3179 - val\_accuracy: 0.8574 - val\_loss: 0.3831
Epoch 2/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{126s} 73ms/step
- accuracy: 0.8277 - loss: 0.4989 - val\_accuracy: 0.8796 - val\_loss: 0.3222
Epoch 3/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{126s} 74ms/step
- accuracy: 0.8636 - loss: 0.4064 - val\_accuracy: 0.8856 - val\_loss: 0.3119
Epoch 4/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{129s} 75ms/step
- accuracy: 0.8835 - loss: 0.3529 - val\_accuracy: 0.8986 - val\_loss: 0.2883
Epoch 5/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{153s} 89ms/step
- accuracy: 0.8931 - loss: 0.3190 - val\_accuracy: 0.8998 - val\_loss: 0.2791
Epoch 6/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{134s} 78ms/step
- accuracy: 0.9003 - loss: 0.2929 - val\_accuracy: 0.9014 - val\_loss: 0.2730
Epoch 7/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{137s} 80ms/step
- accuracy: 0.9076 - loss: 0.2740 - val\_accuracy: 0.9080 - val\_loss: 0.2695
Epoch 8/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{140s} 82ms/step
- accuracy: 0.9158 - loss: 0.2537 - val\_accuracy: 0.9062 - val\_loss: 0.2746
Epoch 9/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{141s} 82ms/step
- accuracy: 0.9201 - loss: 0.2383 - val\_accuracy: 0.9018 - val\_loss: 0.2827
Epoch 10/10
\textbf{1719/1719} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{140s} 81ms/step
- accuracy: 0.9214 - loss: 0.2274 - val\_accuracy: 0.9084 - val\_loss: 0.2856
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{preds} \PY{o}{=} \PY{n}{cnnCls}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{XTest}\PY{p}{)}
\PY{n}{preds} \PY{o}{=} \PY{n}{preds}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{cnnCls}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{n}{XTest}\PY{p}{,} \PY{n}{yTest}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\textbf{313/313} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{9s} 27ms/step
\textbf{313/313} \textcolor{ansi-green}{━━━━━━━━━━━━━━━━━━━━} \textbf{9s} 28ms/step -
accuracy: 0.8996 - loss: 0.3032
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
[0.29478150606155396, 0.899399995803833]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{classStats}\PY{p}{(}\PY{n}{yTest}\PY{p}{,} \PY{n}{preds}\PY{p}{,} \PY{n}{classNames}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
              precision    recall  f1-score   support

           0       0.86      0.84      0.85      1000
           1       0.99      0.98      0.99      1000
           2       0.84      0.85      0.84      1000
           3       0.89      0.92      0.90      1000
           4       0.77      0.87      0.82      1000
           5       0.97      0.99      0.98      1000
           6       0.76      0.64      0.70      1000
           7       0.96      0.96      0.96      1000
           8       0.97      0.99      0.98      1000
           9       0.98      0.95      0.97      1000

    accuracy                           0.90     10000
   macro avg       0.90      0.90      0.90     10000
weighted avg       0.90      0.90      0.90     10000

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Neural Networks_files/Neural Networks_102_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{utils}\PY{o}{.}\PY{n}{plot\PYZus{}model}\PY{p}{(}\PY{n}{cnnCls}\PY{p}{,} \PY{n}{show\PYZus{}shapes}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{ }{}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Neural Networks_files/Neural Networks_103_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}
\end{tcolorbox}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
